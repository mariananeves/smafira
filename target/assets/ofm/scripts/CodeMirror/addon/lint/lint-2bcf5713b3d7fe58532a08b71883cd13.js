(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";function r(t,n){function i(t){if(!r.parentNode)return e.off(document,"mousemove",i);r.style.top=Math.max(0,t.clientY-r.offsetHeight-5)+"px";r.style.left=t.clientX+5+"px"}var r=document.createElement("div");r.className="CodeMirror-lint-tooltip";r.appendChild(n.cloneNode(true));document.body.appendChild(r);e.on(document,"mousemove",i);i(t);if(r.style.opacity!=null)r.style.opacity=1;return r}function i(e){if(e.parentNode)e.parentNode.removeChild(e)}function s(e){if(!e.parentNode)return;if(e.style.opacity==null)i(e);e.style.opacity=0;setTimeout(function(){i(e)},600)}function o(t,n,i){function u(){e.off(i,"mouseout",u);if(o){s(o);o=null}}var o=r(t,n);var a=setInterval(function(){if(o)for(var e=i;;e=e.parentNode){if(e==document.body)return;if(!e){u();break}}if(!o)return clearInterval(a)},400);e.on(i,"mouseout",u)}function u(e,t,n){this.marked=[];this.options=t;this.timeout=null;this.hasGutter=n;this.onMouseOver=function(t){b(e,t)}}function a(t,n){if(n instanceof Function)return{getAnnotations:n};if(!n||n===true)n={};if(!n.getAnnotations)n.getAnnotations=t.getHelper(e.Pos(0,0),"lint");if(!n.getAnnotations)throw new Error("Required option 'getAnnotations' missing (lint addon)");return n}function f(e){var n=e.state.lint;if(n.hasGutter)e.clearGutter(t);for(var r=0;r<n.marked.length;++r)n.marked[r].clear();n.marked.length=0}function l(t,n,r,i){var s=document.createElement("div"),u=s;s.className="CodeMirror-lint-marker-"+n;if(r){u=s.appendChild(document.createElement("div"));u.className="CodeMirror-lint-marker-multiple"}if(i!=false)e.on(u,"mouseover",function(e){o(e,t,u)});return s}function c(e,t){if(e=="error")return e;else return t}function h(e){var t=[];for(var n=0;n<e.length;++n){var r=e[n],i=r.from.line;(t[i]||(t[i]=[])).push(r)}return t}function p(e){var t=e.severity;if(!n.test(t))t="error";var r=document.createElement("div");r.className="CodeMirror-lint-message-"+t;r.appendChild(document.createTextNode(e.message));return r}function d(e){var t=e.state.lint,n=t.options;if(n.async)n.getAnnotations(e,v,n);else v(e,n.getAnnotations(e.getValue(),n.options))}function v(e,r){f(e);var i=e.state.lint,s=i.options;var o=h(r);for(var u=0;u<o.length;++u){var a=o[u];if(!a)continue;var d=null;var v=i.hasGutter&&document.createDocumentFragment();for(var m=0;m<a.length;++m){var g=a[m];var y=g.severity;if(!n.test(y))y="error";d=c(d,y);if(s.formatAnnotation)g=s.formatAnnotation(g);if(i.hasGutter)v.appendChild(p(g));if(g.to)i.marked.push(e.markText(g.from,g.to,{className:"CodeMirror-lint-mark-"+y,__annotation:g}))}if(i.hasGutter)e.setGutterMarker(u,t,l(v,d,a.length>1,i.options.tooltips))}if(s.onUpdateLinting)s.onUpdateLinting(r,o,e)}function m(e){var t=e.state.lint;clearTimeout(t.timeout);t.timeout=setTimeout(function(){d(e)},t.options.delay||500)}function g(e,t){var n=t.target||t.srcElement;o(t,p(e),n)}function b(e,t){if(!/\bCodeMirror-lint-mark-/.test((t.target||t.srcElement).className))return;for(var n=0;n<y.length;n+=2){var r=e.findMarksAt(e.coordsChar({left:t.clientX+y[n],top:t.clientY+y[n+1]},"client"));for(var i=0;i<r.length;++i){var s=r[i],o=s.__annotation;if(o)return g(o,t)}}}var t="CodeMirror-lint-markers";var n=/^(?:error|warning)$/;var y=[0,0,0,5,0,-5,5,0,-5,0];e.defineOption("lint",false,function(n,r,i){if(i&&i!=e.Init){f(n);n.off("change",m);e.off(n.getWrapperElement(),"mouseover",n.state.lint.onMouseOver);delete n.state.lint}if(r){var s=n.getOption("gutters"),o=false;for(var l=0;l<s.length;++l)if(s[l]==t)o=true;var c=n.state.lint=new u(n,a(n,r),o);n.on("change",m);if(c.options.tooltips!=false)e.on(n.getWrapperElement(),"mouseover",c.onMouseOver);d(n)}})})