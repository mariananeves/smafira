(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){function i(e,t,i,o){var u=e.getLineHandle(t.line),a=t.ch-1;var f=a>=0&&r[u.text.charAt(a)]||r[u.text.charAt(++a)];if(!f)return null;var l=f.charAt(1)==">"?1:-1;if(i&&l>0!=(a==t.ch))return null;var c=e.getTokenTypeAt(n(t.line,a+1));var h=s(e,n(t.line,a+(l>0?1:0)),l,c||null,o);return{from:n(t.line,a),to:h&&h.pos,match:h&&h.ch==f.charAt(0),forward:l>0}}function s(e,t,i,s,o){var u=o&&o.maxScanLineLength||1e4;var a=o&&o.maxScanLines||500;var f=[];var l=o&&o.bracketRegex?o.bracketRegex:/[(){}[\]]/;var c=i>0?Math.min(t.line+a,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-a);for(var h=t.line;h!=c;h+=i){var p=e.getLine(h);if(!p)continue;var d=i>0?0:p.length-1,v=i>0?p.length:-1;if(p.length>u)continue;if(h==t.line)d=t.ch-(i<0?1:0);for(;d!=v;d+=i){var m=p.charAt(d);if(l.test(m)&&(s===undefined||e.getTokenTypeAt(n(h,d+1))==s)){var g=r[m];if(g.charAt(1)==">"==i>0)f.push(m);else if(!f.length)return{pos:n(h,d),ch:m};else f.pop()}}}}function o(e,r,s){var o=e.state.matchBrackets.maxHighlightLineLength||1e3;var u=[],a=e.listSelections();for(var f=0;f<a.length;f++){var l=a[f].empty()&&i(e,a[f].head,false,s);if(l&&e.getLine(l.from.line).length<=o&&l.to&&e.getLine(l.to.line).length<=o){var c=l.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";u.push(e.markText(l.from,n(l.from.line,l.from.ch+1),{className:c}));if(l.to)u.push(e.markText(l.to,n(l.to.line,l.to.ch+1),{className:c}))}}if(u.length){if(t&&e.state.focused)e.display.input.focus();var h=function(){e.operation(function(){for(var e=0;e<u.length;e++)u[e].clear()})};if(r)setTimeout(h,800);else return h}}function a(e){e.operation(function(){if(u){u();u=null}u=o(e,false,e.state.matchBrackets)})}var t=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var n=e.Pos;var r={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};var u=null;e.defineOption("matchBrackets",false,function(t,n,r){if(r&&r!=e.Init)t.off("cursorActivity",a);if(n){t.state.matchBrackets=typeof n=="object"?n:{};t.on("cursorActivity",a)}});e.defineExtension("matchBrackets",function(){o(this,true)});e.defineExtension("findMatchingBracket",function(e,t,n){return i(this,e,t,n)});e.defineExtension("scanForBracket",function(e,t,n,r){return s(this,e,t,n,r)})})