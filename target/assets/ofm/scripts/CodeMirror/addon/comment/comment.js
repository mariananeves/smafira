(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";function i(e){var t=e.search(n);return t==-1?0:t}var t={};var n=/[^\s\u00a0]/;var r=e.Pos;e.commands.toggleComment=function(e){var t=Infinity,n=e.listSelections(),i=null;for(var s=n.length-1;s>=0;s--){var o=n[s].from(),u=n[s].to();if(o.line>=t)continue;if(u.line>=t)u=r(t,0);t=o.line;if(i==null){if(e.uncomment(o,u))i="un";else{e.lineComment(o,u);i="line"}}else if(i=="un"){e.uncomment(o,u)}else{e.lineComment(o,u)}}};e.defineExtension("lineComment",function(e,s,o){if(!o)o=t;var u=this,a=u.getModeAt(e);var f=o.lineComment||a.lineComment;if(!f){if(o.blockCommentStart||a.blockCommentStart){o.fullLines=true;u.blockComment(e,s,o)}return}var l=u.getLine(e.line);if(l==null)return;var c=Math.min(s.ch!=0||s.line==e.line?s.line+1:s.line,u.lastLine()+1);var h=o.padding==null?" ":o.padding;var p=o.commentBlankLines||e.line==s.line;u.operation(function(){if(o.indent){var t=l.slice(0,i(l));for(var s=e.line;s<c;++s){var a=u.getLine(s),d=t.length;if(!p&&!n.test(a))continue;if(a.slice(0,d)!=t)d=i(a);u.replaceRange(t+f+h,r(s,0),r(s,d))}}else{for(var s=e.line;s<c;++s){if(p||n.test(u.getLine(s)))u.replaceRange(f+h,r(s,0))}}})});e.defineExtension("blockComment",function(e,i,s){if(!s)s=t;var o=this,u=o.getModeAt(e);var a=s.blockCommentStart||u.blockCommentStart;var f=s.blockCommentEnd||u.blockCommentEnd;if(!a||!f){if((s.lineComment||u.lineComment)&&s.fullLines!=false)o.lineComment(e,i,s);return}var l=Math.min(i.line,o.lastLine());if(l!=e.line&&i.ch==0&&n.test(o.getLine(l)))--l;var c=s.padding==null?" ":s.padding;if(e.line>l)return;o.operation(function(){if(s.fullLines!=false){var t=n.test(o.getLine(l));o.replaceRange(c+f,r(l));o.replaceRange(a+c,r(e.line,0));var h=s.blockCommentLead||u.blockCommentLead;if(h!=null)for(var p=e.line+1;p<=l;++p)if(p!=l||t)o.replaceRange(h+c,r(p,0))}else{o.replaceRange(f,i);o.replaceRange(a,e)}})});e.defineExtension("uncomment",function(e,i,s){if(!s)s=t;var o=this,u=o.getModeAt(e);var a=Math.min(i.line,o.lastLine()),f=Math.min(e.line,a);var l=s.lineComment||u.lineComment,c=[];var h=s.padding==null?" ":s.padding,p;e:{if(!l)break e;for(var d=f;d<=a;++d){var v=o.getLine(d);var m=v.indexOf(l);if(m>-1&&!/comment/.test(o.getTokenTypeAt(r(d,m+1))))m=-1;if(m==-1&&(d!=a||d==f)&&n.test(v))break e;if(m>-1&&n.test(v.slice(0,m)))break e;c.push(v)}o.operation(function(){for(var e=f;e<=a;++e){var t=c[e-f];var n=t.indexOf(l),i=n+l.length;if(n<0)continue;if(t.slice(i,i+h.length)==h)i+=h.length;p=true;o.replaceRange("",r(e,n),r(e,i))}});if(p)return true}var g=s.blockCommentStart||u.blockCommentStart;var y=s.blockCommentEnd||u.blockCommentEnd;if(!g||!y)return false;var b=s.blockCommentLead||u.blockCommentLead;var w=o.getLine(f),E=a==f?w:o.getLine(a);var S=w.indexOf(g),x=E.lastIndexOf(y);if(x==-1&&f!=a){E=o.getLine(--a);x=E.lastIndexOf(y)}if(S==-1||x==-1||!/comment/.test(o.getTokenTypeAt(r(f,S+1)))||!/comment/.test(o.getTokenTypeAt(r(a,x+1))))return false;o.operation(function(){o.replaceRange("",r(a,x-(h&&E.slice(x-h.length,x)==h?h.length:0)),r(a,x+y.length));var e=S+g.length;if(h&&w.slice(e,e+h.length)==h)e+=h.length;o.replaceRange("",r(f,S),r(f,e));if(b)for(var t=f+1;t<=a;++t){var i=o.getLine(t),s=i.indexOf(b);if(s==-1||n.test(i.slice(0,s)))continue;var u=s+b.length;if(h&&i.slice(u,u+h.length)==h)u+=h.length;o.replaceRange("",r(t,s),r(t,u))}});return true})})