(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";function r(e,t){this.mv=e;this.type=t;this.classes=t=="left"?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}function i(t){function s(i){if(i=="full"){if(t.svg)N(t.svg);N(t.copyButtons);f(t.edit,n.marked,t.classes);f(t.orig,r.marked,t.classes);n.from=n.to=r.from=r.to=0}if(t.diffOutOfDate){t.diff=y(t.orig.getValue(),t.edit.getValue());t.diffOutOfDate=false;e.signal(t.edit,"updateDiff",t.diff)}if(t.showDifferences){l(t.edit,t.diff,n,DIFF_INSERT,t.classes);l(t.orig,t.diff,r,DIFF_DELETE,t.classes)}h(t)}function o(e){clearTimeout(i);i=setTimeout(s,e==true?250:100)}function u(){if(!t.diffOutOfDate){t.diffOutOfDate=true;n.from=n.to=r.from=r.to=0}o(true)}var n={from:0,to:0,marked:[]};var r={from:0,to:0,marked:[]};var i;t.edit.on("change",u);t.orig.on("change",u);t.edit.on("markerAdded",o);t.edit.on("markerCleared",o);t.orig.on("markerAdded",o);t.orig.on("markerCleared",o);t.edit.on("viewportChange",o);t.orig.on("viewportChange",o);s();return s}function s(e){e.edit.on("scroll",function(){o(e,DIFF_INSERT)&&h(e)});e.orig.on("scroll",function(){o(e,DIFF_DELETE)&&h(e)})}function o(e,t){if(e.diffOutOfDate)return false;if(!e.lockScroll)return true;var n,r,i=+(new Date);if(t==DIFF_INSERT){n=e.edit;r=e.orig}else{n=e.orig;r=e.edit}if(n.state.scrollSetBy==e&&(n.state.scrollSetAt||0)+50>i)return false;var s=n.getScrollInfo(),o=.5*s.clientHeight,a=s.top+o;var f=n.lineAtHeight(a,"local");var l=x(e.diff,f,t==DIFF_INSERT);var c=u(n,t==DIFF_INSERT?l.edit:l.orig);var h=u(r,t==DIFF_INSERT?l.orig:l.edit);var p=(a-c.top)/(c.bot-c.top);var d=h.top-o+p*(h.bot-h.top);var v,m;if(d>s.top&&(m=s.top/o)<1){d=d*m+s.top*(1-m)}else if((v=s.height-s.clientHeight-s.top)<o){var g=r.getScrollInfo();var y=g.height-g.clientHeight-d;if(y>v&&(m=v/o)<1)d=d*m+(g.height-g.clientHeight-v)*(1-m)}r.scrollTo(s.left,d);r.state.scrollSetAt=i;r.state.scrollSetBy=e;return true}function u(e,t){var n=t.after;if(n==null)n=e.lastLine()+1;return{top:e.heightAtLine(t.before||0,"local"),bot:e.heightAtLine(n,"local")}}function a(e,t,n){e.lockScroll=t;if(t&&n!=false)o(e,DIFF_INSERT)&&h(e);e.lockButton.innerHTML=t?"⇛⇚":"⇛&nbsp;&nbsp;⇚"}function f(t,n,r){for(var i=0;i<n.length;++i){var s=n[i];if(s instanceof e.TextMarker){s.clear()}else{t.removeLineClass(s,"background",r.chunk);t.removeLineClass(s,"background",r.start);t.removeLineClass(s,"background",r.end)}}n.length=0}function l(e,t,n,r,i){var s=e.getViewport();e.operation(function(){if(n.from==n.to||s.from-n.to>20||n.from-s.to>20){f(e,n.marked,i);c(e,t,r,n.marked,s.from,s.to,i);n.from=s.from;n.to=s.to}else{if(s.from<n.from){c(e,t,r,n.marked,s.from,n.from,i);n.from=s.from}if(s.to>n.to){c(e,t,r,n.marked,n.to,s.to,i);n.to=s.to}}})}function c(e,n,r,i,s,o,u){function h(t,n){var r=Math.max(s,t),a=Math.min(o,n);for(var f=r;f<a;++f){var l=e.addLineClass(f,"background",u.chunk);if(f==t)e.addLineClass(l,"background",u.start);if(f==n-1)e.addLineClass(l,"background",u.end);i.push(l)}if(t==n&&r==n&&a==n){if(r)i.push(e.addLineClass(r-1,"background",u.end));else i.push(e.addLineClass(r,"background",u.start))}}var a=t(0,0);var f=t(s,0),l=e.clipPos(t(o-1));var c=r==DIFF_DELETE?u.del:u.insert;var p=0;for(var d=0;d<n.length;++d){var v=n[d],m=v[0],g=v[1];if(m==DIFF_EQUAL){var y=a.line+(S(n,d)?0:1);L(a,g);var b=a.line+(E(n,d)?1:0);if(b>y){if(d)h(p,y);p=b}}else{if(m==r){var w=L(a,g,true);var x=O(f,a),T=A(l,w);if(!M(x,T))i.push(e.markText(x,T,{className:c}));a=w}}}if(p<=a.line)h(p,a.line+1)}function h(e){if(!e.showDifferences)return;if(e.svg){N(e.svg);var t=e.gap.offsetWidth;C(e.svg,"width",t,"height",e.gap.offsetHeight)}N(e.copyButtons);var r=e.type=="left";var i=e.edit.getViewport(),s=e.orig.getViewport();var o=e.edit.getScrollInfo().top,u=e.orig.getScrollInfo().top;b(e.diff,function(a,f,l,c){if(l>i.to||c<i.from||a>s.to||f<s.from)return;var h=e.orig.heightAtLine(a,"local")-u,p=h;if(e.svg){var d=e.edit.heightAtLine(l,"local")-o;if(r){var v=h;h=d;d=v}var m=e.orig.heightAtLine(f,"local")-u;var g=e.edit.heightAtLine(c,"local")-o;if(r){var v=m;m=g;g=v}var y=" C "+t/2+" "+d+" "+t/2+" "+h+" "+(t+2)+" "+h;var b=" C "+t/2+" "+m+" "+t/2+" "+g+" -1 "+g;C(e.svg.appendChild(document.createElementNS(n,"path")),"d","M -1 "+d+y+" L "+(t+2)+" "+m+b+" z","class",e.classes.connect)}var w=e.copyButtons.appendChild(T("div",e.type=="left"?"⇝":"⇜","CodeMirror-merge-copy"));w.title="Revert chunk";w.chunk={topEdit:l,botEdit:c,topOrig:a,botOrig:f};w.style.top=p+"px"})}function p(e,n){if(e.diffOutOfDate)return;e.edit.replaceRange(e.orig.getRange(t(n.topOrig,0),t(n.botOrig,0)),t(n.topEdit,0),t(n.botEdit,0))}function v(t){var r=t.lockButton=T("div",null,"CodeMirror-merge-scrolllock");r.title="Toggle locked scrolling";var i=T("div",[r],"CodeMirror-merge-scrolllock-wrap");e.on(r,"click",function(){a(t,!t.lockScroll)});t.copyButtons=T("div",null,"CodeMirror-merge-copybuttons-"+t.type);e.on(t.copyButtons,"click",function(e){var n=e.target||e.srcElement;if(n.chunk)p(t,n.chunk)});var s=[t.copyButtons,i];var o=document.createElementNS&&document.createElementNS(n,"svg");if(o&&!o.createSVGRect)o=null;t.svg=o;if(o)s.push(o);return t.gap=T("div",s,"CodeMirror-merge-gap")}function m(e){if(typeof e=="string")return e;else return e.getValue()}function y(e,t){var n=g.diff_main(e,t);g.diff_cleanupSemantic(n);for(var r=0;r<n.length;++r){var i=n[r];if(!i[1]){n.splice(r--,1)}else if(r&&n[r-1][0]==i[0]){n.splice(r--,1);n[r][1]+=i[1]}}return n}function b(e,n){var r=0,i=0;var s=t(0,0),o=t(0,0);for(var u=0;u<e.length;++u){var a=e[u],f=a[0];if(f==DIFF_EQUAL){var l=S(e,u)?0:1;var c=s.line+l,h=o.line+l;L(s,a[1],null,o);var p=E(e,u)?1:0;var d=s.line+p,v=o.line+p;if(d>c){if(u)n(i,h,r,c);r=d;i=v}}else{L(f==DIFF_INSERT?s:o,a[1])}}if(r<=s.line||i<=o.line)n(i,o.line+1,r,s.line+1)}function w(e){var t=[];b(e,function(e,n,r,i){t.push({origFrom:e,origTo:n,editFrom:r,editTo:i})});return t}function E(e,t){if(t==e.length-1)return true;var n=e[t+1][1];if(n.length==1||n.charCodeAt(0)!=10)return false;if(t==e.length-2)return true;n=e[t+2][1];return n.length>1&&n.charCodeAt(0)==10}function S(e,t){if(t==0)return true;var n=e[t-1][1];if(n.charCodeAt(n.length-1)!=10)return false;if(t==1)return true;n=e[t-2][1];return n.charCodeAt(n.length-1)==10}function x(e,t,n){var r,i,s,o;b(e,function(e,u,a,f){var l=n?a:e;var c=n?f:u;if(i==null){if(l>t){i=a;o=e}else if(c>t){i=f;o=u}}if(c<=t){r=f;s=u}else if(l<=t){r=a;s=e}});return{edit:{before:r,after:i},orig:{before:s,after:o}}}function T(e,t,n,r){var i=document.createElement(e);if(n)i.className=n;if(r)i.style.cssText=r;if(typeof t=="string")i.appendChild(document.createTextNode(t));else if(t)for(var s=0;s<t.length;++s)i.appendChild(t[s]);return i}function N(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild)}function C(e){for(var t=1;t<arguments.length;t+=2)e.setAttribute(arguments[t],arguments[t+1])}function k(e,t){if(!t)t={};for(var n in e)if(e.hasOwnProperty(n))t[n]=e[n];return t}function L(e,n,r,i){var s=r?t(e.line,e.ch):e,o=0;for(;;){var u=n.indexOf("\n",o);if(u==-1)break;++s.line;if(i)++i.line;o=u+1}s.ch=(o?0:s.ch)+(n.length-o);if(i)i.ch=(o?0:i.ch)+(n.length-o);return s}function A(e,t){return(e.line-t.line||e.ch-t.ch)<0?e:t}function O(e,t){return(e.line-t.line||e.ch-t.ch)>0?e:t}function M(e,t){return e.line==t.line&&e.ch==t.ch}var t=e.Pos;var n="http://www.w3.org/2000/svg";r.prototype={constructor:r,init:function(t,n,r){this.edit=this.mv.edit;this.orig=e(t,k({value:n,readOnly:true},k(r)));this.diff=y(m(n),m(r.value));this.diffOutOfDate=false;this.showDifferences=r.showDifferences!==false;this.forceUpdate=i(this);a(this,true,false);s(this)},setShowDifferences:function(e){e=e!==false;if(e!=this.showDifferences){this.showDifferences=e;this.forceUpdate("full")}}};var d=e.MergeView=function(t,n){if(!(this instanceof d))return new d(t,n);var i=n.origLeft,s=n.origRight==null?n.orig:n.origRight;var o=i!=null,u=s!=null;var a=1+(o?1:0)+(u?1:0);var f=[],l=this.left=null,c=this.right=null;if(o){l=this.left=new r(this,"left");var p=T("div",null,"CodeMirror-merge-pane");f.push(p);f.push(v(l))}var m=T("div",null,"CodeMirror-merge-pane");f.push(m);if(u){c=this.right=new r(this,"right");f.push(v(c));var g=T("div",null,"CodeMirror-merge-pane");f.push(g)}(u?g:m).className+=" CodeMirror-merge-pane-rightmost";f.push(T("div",null,null,"height: 0; clear: both;"));var y=this.wrap=t.appendChild(T("div",f,"CodeMirror-merge CodeMirror-merge-"+a+"pane"));this.edit=e(m,k(n));if(l)l.init(p,i,n);if(c)c.init(g,s,n);var b=function(){if(l)h(l);if(c)h(c)};e.on(window,"resize",b);var w=setInterval(function(){for(var t=y.parentNode;t&&t!=document.body;t=t.parentNode){}if(!t){clearInterval(w);e.off(window,"resize",b)}},5e3)};d.prototype={constuctor:d,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(e){if(this.right)this.right.setShowDifferences(e);if(this.left)this.left.setShowDifferences(e)},rightChunks:function(){return this.right&&w(this.right.diff)},leftChunks:function(){return this.left&&w(this.left.diff)}};var g=new diff_match_patch})