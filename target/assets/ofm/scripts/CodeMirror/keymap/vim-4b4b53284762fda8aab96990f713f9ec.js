(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js"));else if(typeof define=="function"&&define.amd)define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],e);else e(CodeMirror)})(function(e){"use strict";var t=[{keys:["<Left>"],type:"keyToKey",toKeys:["h"]},{keys:["<Right>"],type:"keyToKey",toKeys:["l"]},{keys:["<Up>"],type:"keyToKey",toKeys:["k"]},{keys:["<Down>"],type:"keyToKey",toKeys:["j"]},{keys:["<Space>"],type:"keyToKey",toKeys:["l"]},{keys:["<BS>"],type:"keyToKey",toKeys:["h"]},{keys:["<C-Space>"],type:"keyToKey",toKeys:["W"]},{keys:["<C-BS>"],type:"keyToKey",toKeys:["B"]},{keys:["<S-Space>"],type:"keyToKey",toKeys:["w"]},{keys:["<S-BS>"],type:"keyToKey",toKeys:["b"]},{keys:["<C-n>"],type:"keyToKey",toKeys:["j"]},{keys:["<C-p>"],type:"keyToKey",toKeys:["k"]},{keys:["<C-[>"],type:"keyToKey",toKeys:["<Esc>"]},{keys:["<C-c>"],type:"keyToKey",toKeys:["<Esc>"]},{keys:["s"],type:"keyToKey",toKeys:["c","l"],context:"normal"},{keys:["s"],type:"keyToKey",toKeys:["x","i"],context:"visual"},{keys:["S"],type:"keyToKey",toKeys:["c","c"],context:"normal"},{keys:["S"],type:"keyToKey",toKeys:["d","c","c"],context:"visual"},{keys:["<Home>"],type:"keyToKey",toKeys:["0"]},{keys:["<End>"],type:"keyToKey",toKeys:["$"]},{keys:["<PageUp>"],type:"keyToKey",toKeys:["<C-b>"]},{keys:["<PageDown>"],type:"keyToKey",toKeys:["<C-f>"]},{keys:["<CR>"],type:"keyToKey",toKeys:["j","^"],context:"normal"},{keys:["H"],type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:["M"],type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:["L"],type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:["h"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:["l"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:["j"],type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:["k"],type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:["g","j"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:["g","k"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:["w"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:["W"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:["e"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:["E"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:["b"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:["B"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:["g","e"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:["g","E"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:["{"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:["}"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:["<C-f>"],type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:["<C-b>"],type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:["<C-d>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:["<C-u>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:["g","g"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:["G"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:["0"],type:"motion",motion:"moveToStartOfLine"},{keys:["^"],type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["+"],type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:["-"],type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:["_"],type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:["$"],type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:["%"],type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:["f","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:["F","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:["t","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:["T","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:[";"],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:[","],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:["'","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:true,linewise:true}},{keys:["`","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:["]","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:["[","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:["]","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:["[","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:["]","p"],type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true,matchIndent:true}},{keys:["[","p"],type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true,matchIndent:true}},{keys:["]","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:["[","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:["|"],type:"motion",motion:"moveToColumn",motionArgs:{}},{keys:["o"],type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{},context:"visual"},{keys:["d"],type:"operator",operator:"delete"},{keys:["y"],type:"operator",operator:"yank"},{keys:["c"],type:"operator",operator:"change"},{keys:[">"],type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:["<"],type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:["g","~"],type:"operator",operator:"swapcase"},{keys:["n"],type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:["N"],type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:["x"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:["X"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:["D"],type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:["Y"],type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:["C"],type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:["~"],type:"operatorMotion",operator:"swapcase",operatorArgs:{shouldMoveCursor:true},motion:"moveByCharacters",motionArgs:{forward:true}},{keys:["<C-i>"],type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:["<C-o>"],type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:["<C-e>"],type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:["<C-y>"],type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:["a"],type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"}},{keys:["A"],type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"}},{keys:["i"],type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"}},{keys:["I"],type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"}},{keys:["o"],type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true}},{keys:["O"],type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false}},{keys:["v"],type:"action",action:"toggleVisualMode"},{keys:["V"],type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:["g","v"],type:"action",action:"reselectLastSelection"},{keys:["J"],type:"action",action:"joinLines",isEdit:true},{keys:["p"],type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:["P"],type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:["r","character"],type:"action",action:"replace",isEdit:true},{keys:["@","character"],type:"action",action:"replayMacro"},{keys:["q","character"],type:"action",action:"enterMacroRecordMode"},{keys:["R"],type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true}},{keys:["u"],type:"action",action:"undo"},{keys:["<C-r>"],type:"action",action:"redo"},{keys:["m","character"],type:"action",action:"setMark"},{keys:['"',"character"],type:"action",action:"setRegister"},{keys:["z","z"],type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:["z","."],type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","t"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:["z","<CR>"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","-"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:["z","b"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["."],type:"action",action:"repeatLastEdit"},{keys:["<C-a>"],type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:["<C-x>"],type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:["a","character"],type:"motion",motion:"textObjectManipulation"},{keys:["i","character"],type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:["/"],type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:["?"],type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:["*"],type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:["#"],type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:["g","*"],type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:["g","#"],type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:[":"],type:"ex"}];var n=e.Pos;var r=function(){function i(e,t){var r=e.state.vim;if(r.insertMode||r.exMode)return;var i=t.ranges[0].head;var s=t.ranges[0].anchor;if(i.ch&&i.ch==e.doc.getLine(i.line).length){var o=n(i.line,i.ch-1);t.update([{anchor:J(i,s)?o:s,head:o}])}}function s(e){var t=e.state.vim;if(!t.onPasteFn){t.onPasteFn=function(){if(!t.insertMode){e.setCursor(W(e.getCursor(),0,1));R.enterInsertMode(e,{},t)}}}return t.onPasteFn}function f(e,t){var n=[];for(var r=e;r<e+t;r++){n.push(String.fromCharCode(r))}return n}function g(e,t){return t>=e.firstLine()&&t<=e.lastLine()}function y(e){return/^[a-z]$/.test(e)}function b(e){return"()[]{}".indexOf(e)!=-1}function w(e){return o.test(e)}function E(e){return/^[A-Z]$/.test(e)}function S(e){return/^\s*$/.test(e)}function x(e,t){for(var n=0;n<t.length;n++){if(t[n]==e){return true}}return false}function N(e,t,n){if(t===undefined){throw Error("defaultValue is required")}if(!n){n="string"}T[e]={type:n,defaultValue:t};C(e,t)}function C(e,t){var n=T[e];if(!n){throw Error("Unknown option: "+e)}if(n.type=="boolean"){if(t&&t!==true){throw Error("Invalid argument: "+e+"="+t)}else if(t!==false){t=true}}n.value=n.type=="boolean"?!!t:t}function k(e){var t=T[e];if(!t){throw Error("Unknown option: "+e)}return t.value}function O(){this.latestRegister=undefined;this.isPlaying=false;this.isRecording=false;this.replaySearchQueries=[];this.onRecordingDone=undefined;this.lastInsertModeChanges=A()}function M(e){if(!e.state.vim){e.state.vim={inputState:new H,lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:false,insertModeRepeat:undefined,visualMode:false,visualLine:false,lastSelection:null}}return e.state.vim}function D(){_={searchQuery:null,searchIsReversed:false,lastSubstituteReplacePart:undefined,jumpList:L(),macroModeState:new O,lastChararacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new j({})};for(var e in T){var t=T[e];t.value=t.defaultValue}}function H(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null}function B(e,t){this.clear();this.keyBuffer=[e||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!t}function j(e){this.registers=e;this.unnamedRegister=e['"']=new B;e["."]=new B;e[":"]=new B}function U(e,t,r){var i=Math.min(Math.max(e.firstLine(),t.line),e.lastLine());var s=G(e,i)-1;s=r?s+1:s;var o=Math.min(Math.max(0,t.ch),s);return n(i,o)}function z(e){var t={};for(var n in e){if(e.hasOwnProperty(n)){t[n]=e[n]}}return t}function W(e,t,r){return n(e.line+t,e.ch+r)}function X(e,t){for(var n=0;n<e.length;n++){if(e[n]!=t[n]&&t[n]!="character"){return false}}return true}function V(e,t,n){return function(){for(var r=0;r<n;r++){t(e)}}}function $(e){return n(e.line,e.ch)}function J(e,t){return e.ch==t.ch&&e.line==t.line}function K(e,t){if(e.line<t.line){return true}if(e.line==t.line&&e.ch<t.ch){return true}return false}function Q(e,t,n){var r=K(e,t);var i=K(t,n);return r&&i}function G(e,t){return e.getLine(t).length}function Y(e){return e.split("").reverse().join("")}function Z(e){if(e.trim){return e.trim()}return e.replace(/^\s+|\s+$/g,"")}function et(e){return e.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function tt(t){t.off("mousedown",tt);var n=t.state.vim;n.lastSelection={curStart:n.marks["<"].find(),curEnd:n.marks[">"].find(),visualMode:n.visualMode,visualLine:n.visualLine};n.visualMode=false;n.visualLine=false;var r=t.getCursor("anchor");var i=t.getCursor("head");if(!J(r,i)){t.setCursor(U(t,i))}e.signal(t,"vim-mode-change",{mode:"normal"})}function nt(e,t,n){var r=e.getRange(t,n);if(/\n\s*$/.test(r)){var i=r.split("\n");i.pop();var s;for(var s=i.pop();i.length>0&&s&&S(s);s=i.pop()){n.line--;n.ch=0}if(s){n.line--;n.ch=G(e,n.line)}else{n.ch=0}}}function rt(e,t,n){t.ch=0;n.ch=0;n.line++}function it(e){if(!e){return 0}var t=e.search(/\S/);return t==-1?e.length:t}function st(e,t,r,i,s){var o=e.getCursor();var u=e.getLine(o.line);var a=o.ch;var f=u.substring(a);var l;if(s){l=f.search(/\w/)}else{l=f.search(/\S/)}if(l==-1){return null}a+=l;f=u.substring(a);var c=u.substring(0,a);var h;if(i){h=/^\S+/}else{if(/\w/.test(u.charAt(a))){h=/^\w+/}else{h=/^[^\w\s]+/}}var p=h.exec(f);var d=a;var v=a+p[0].length;var m=Y(c);var g=h.exec(m);if(g){d-=g[0].length}if(t){var y=u.substring(v);var b=y.match(/^\s*/)[0].length;if(b>0){v+=b}else{var w=m.length-d;var E=m.substring(w);var S=E.match(/^\s*/)[0].length;d-=S}}return{start:n(o.line,d),end:n(o.line,v)}}function ot(e,t,n){if(!J(t,n)){_.jumpList.add(e,t,n)}}function ut(e,t){_.lastChararacterSearch.increment=e;_.lastChararacterSearch.forward=t.forward;_.lastChararacterSearch.selectedCharacter=t.selectedCharacter}function lt(e,t,r,i){var s=$(e.getCursor());var o=r?1:-1;var u=r?e.lineCount():-1;var a=s.ch;var f=s.line;var l=e.getLine(f);var c={lineText:l,nextCh:l.charAt(a),lastCh:null,index:a,symb:i,reverseSymb:(r?{")":"(","}":"{"}:{"(":")","{":"}"})[i],forward:r,depth:0,curMoveThrough:false};var h=at[i];if(!h)return s;var p=ft[h].init;var d=ft[h].isComplete;if(p){p(c)}while(f!==u&&t){c.index+=o;c.nextCh=c.lineText.charAt(c.index);if(!c.nextCh){f+=o;c.lineText=e.getLine(f)||"";if(o>0){c.index=0}else{var v=c.lineText.length;c.index=v>0?v-1:0}c.nextCh=c.lineText.charAt(c.index)}if(d(c)){s.line=f;s.ch=c.index;t--}}if(c.nextCh||c.curMoveThrough){return n(f,c.index)}return s}function ct(e,t,n,r,i){var s=t.line;var o=t.ch;var f=e.getLine(s);var l=n?1:-1;var c=r?a:u;if(i&&f==""){s+=l;f=e.getLine(s);if(!g(e,s)){return null}o=n?0:f.length}while(true){if(i&&f==""){return{from:0,to:0,line:s}}var h=l>0?f.length:-1;var p=h,d=h;while(o!=h){var v=false;for(var m=0;m<c.length&&!v;++m){if(c[m].test(f.charAt(o))){p=o;while(o!=h&&c[m].test(f.charAt(o))){o+=l}d=o;v=p!=d;if(p==t.ch&&s==t.line&&d==p+l){continue}else{return{from:Math.min(p,d+1),to:Math.max(p,d),line:s}}}}if(!v){o+=l}}s+=l;if(!g(e,s)){return null}f=e.getLine(s);o=l>0?0:f.length}throw new Error("The impossible happened.")}function ht(e,t,r,i,s){var o=e.getCursor();var u=$(o);var a=[];if(r&&!i||!r&&i){t++}var f=!(r&&i);for(var l=0;l<t;l++){var c=ct(e,o,r,s,f);if(!c){var h=G(e,e.lastLine());a.push(r?{line:e.lastLine(),from:h,to:h}:{line:0,from:0,to:0});break}a.push(c);o=n(c.line,r?c.to-1:c.from)}var p=a.length!=t;var d=a[0];var v=a.pop();if(r&&!i){if(!p&&(d.from!=u.ch||d.line!=u.line)){v=a.pop()}return n(v.line,v.from)}else if(r&&i){return n(v.line,v.to-1)}else if(!r&&i){if(!p&&(d.to!=u.ch||d.line!=u.line)){v=a.pop()}return n(v.line,v.to)}else{return n(v.line,v.from)}}function pt(e,t,r,i){var s=e.getCursor();var o=s.ch;var u;for(var a=0;a<t;a++){var f=e.getLine(s.line);u=mt(o,f,i,r,true);if(u==-1){return null}o=u}return n(e.getCursor().line,u)}function dt(e,t){var r=e.getCursor().line;return U(e,n(r,t-1))}function vt(e,t,n,r){if(!x(n,v)){return}if(t.marks[n]){t.marks[n].clear()}t.marks[n]=e.setBookmark(r)}function mt(e,t,n,r,i){var s;if(r){s=t.indexOf(n,e+1);if(s!=-1&&!i){s-=1}}else{s=t.lastIndexOf(n,e-1);if(s!=-1&&!i){s+=1}}return s}function gt(e,t,r){var i=e.getCursor(),s,o;var u={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/}[t];var a={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"}[t];var f=e.getLine(i.line).charAt(i.ch);var l=f===a?1:0;s=e.scanForBracket(n(i.line,i.ch+l),-1,null,{bracketRegex:u});o=e.scanForBracket(n(i.line,i.ch+l),1,null,{bracketRegex:u});if(!s||!o){return{start:i,end:i}}s=s.pos;o=o.pos;if(s.line==o.line&&s.ch>o.ch||s.line>o.line){var c=s;s=o;o=c}if(r){o.ch+=1}else{s.ch+=1}return{start:s,end:o}}function yt(e,t,r){var i=$(e.getCursor());var s=e.getLine(i.line);var o=s.split("");var u,a,f,l;var c=o.indexOf(t);if(i.ch<c){i.ch=c}else if(c<i.ch&&o[i.ch]==t){a=i.ch;--i.ch}if(o[i.ch]==t&&!a){u=i.ch+1}else{for(f=i.ch;f>-1&&!u;f--){if(o[f]==t){u=f+1}}}if(u&&!a){for(f=u,l=o.length;f<l&&!a;f++){if(o[f]==t){a=f}}}if(!u||!a){return{start:i,end:i}}if(r){--u;++a}return{start:n(i.line,u),end:n(i.line,a)}}function bt(){}function wt(e){var t=e.state.vim;return t.searchState_||(t.searchState_=new bt)}function Et(e,t,n,r,i){if(e.openDialog){e.openDialog(t,r,{bottom:true,value:i.value,onKeyDown:i.onKeyDown,onKeyUp:i.onKeyUp})}else{r(prompt(n,""))}}function St(e){var t=false;var n=[];for(var r=0;r<e.length;r++){var i=e.charAt(r);if(!t&&i=="/"){n.push(r)}t=!t&&i=="\\"}return n}function xt(e){var t=["|","(",")","{"];var n=["}"];var r=false;var i=[];for(var s=-1;s<e.length;s++){var o=e.charAt(s)||"";var u=e.charAt(s+1)||"";var a=t.indexOf(u)!=-1;if(r){if(o!=="\\"||!a){i.push(o)}r=false}else{if(o==="\\"){r=true;if(n.indexOf(u)!=-1){a=true}if(!a||u==="\\"){i.push(o)}}else{i.push(o);if(a&&u!=="\\"){i.push("\\")}}}}return i.join("")}function Tt(e){var t=false;var n=[];for(var r=-1;r<e.length;r++){var i=e.charAt(r)||"";var s=e.charAt(r+1)||"";if(t){n.push(i);t=false}else{if(i==="\\"){t=true;if(w(s)||s==="$"){n.push("$")}else if(s!=="/"&&s!=="\\"){n.push("\\")}}else{if(i==="$"){n.push("$")}n.push(i);if(s==="/"){n.push("\\")}}}}return n.join("")}function Nt(t){var n=new e.StringStream(t);var r=[];while(!n.eol()){while(n.peek()&&n.peek()!="\\"){r.push(n.next())}if(n.match("\\/",true)){r.push("/")}else if(n.match("\\\\",true)){r.push("\\")}else{r.push(n.next())}}return r.join("")}function Ct(e,t,n){if(e instanceof RegExp){return e}var r=St(e);var i;var s;if(!r.length){i=e}else{i=e.substring(0,r[0]);var o=e.substring(r[0]);s=o.indexOf("i")!=-1}if(!i){return null}if(!k("pcre")){i=xt(i)}if(n){t=/^[^A-Z]*$/.test(i)}var u=new RegExp(i,t||s?"i":undefined);return u}function kt(e,t){if(e.openNotification){e.openNotification('<span style="color: red">'+t+"</span>",{bottom:true,duration:5e3})}else{alert(t)}}function Lt(e,t){var n="";if(e){n+='<span style="font-family: monospace">'+e+"</span>"}n+='<input type="text"/> '+'<span style="color: #888">';if(t){n+='<span style="color: #888">';n+=t;n+="</span>"}return n}function Ot(e,t){var n=(t.prefix||"")+" "+(t.desc||"");var r=Lt(t.prefix,t.desc);Et(e,r,n,t.onClose,t)}function Mt(e,t){if(e instanceof RegExp&&t instanceof RegExp){var n=["global","multiline","ignoreCase","source"];for(var r=0;r<n.length;r++){var i=n[r];if(e[i]!==t[i]){return false}}return true}return false}function _t(e,t,n,r){if(!t){return}var i=wt(e);var s=Ct(t,!!n,!!r);if(!s){return}Pt(e,s);if(Mt(s,i.getQuery())){return s}i.setQuery(s);return s}function Dt(e){if(e.source.charAt(0)=="^"){var t=true}return{token:function(n){if(t&&!n.sol()){n.skipToEnd();return}var r=n.match(e,false);if(r){if(r[0].length==0){n.next();return"searching"}if(!n.sol()){n.backUp(1);if(!e.exec(n.next()+r[0])){n.next();return null}}n.match(e);return"searching"}while(!n.eol()){n.next();if(n.match(e,false))break}},query:e}}function Pt(e,t){var n=wt(e).getOverlay();if(!n||t!=n.query){if(n){e.removeOverlay(n)}n=Dt(t);e.addOverlay(n);wt(e).setOverlay(n)}}function Ht(e,t,r,i){if(i===undefined){i=1}return e.operation(function(){var s=e.getCursor();var o=e.getSearchCursor(r,s);for(var u=0;u<i;u++){var a=o.find(t);if(u==0&&a&&J(o.from(),s)){a=o.find(t)}if(!a){o=e.getSearchCursor(r,t?n(e.lastLine()):n(e.firstLine(),0));if(!o.find(t)){return}}}return o.from()})}function Bt(e){e.removeOverlay(wt(e).getOverlay());wt(e).setOverlay(null)}function jt(e,t,n){if(typeof e!="number"){e=e.line}if(t instanceof Array){return x(e,t)}else{if(n){return e>=t&&e<=n}else{return e==t}}}function Ft(e){var t=e.getScrollInfo();var n=6;var r=10;var i=e.coordsChar({left:0,top:n+t.top},"local");var s=t.clientHeight-r+t.top;var o=e.coordsChar({left:0,top:s},"local");return{top:i.line,bottom:o.line}}function qt(e){var t,n;var r=[];while(e){n=/<\w+-.+?>|<\w+>|./.exec(e);if(n===null)break;t=n[0];e=e.substring(n.index+t.length);r.push(t)}return r}function zt(t,n,r,i,s,o,u){function l(){t.operation(function(){while(!a){c();h()}p()})}function c(){var e=t.getRange(s.from(),s.to());var n=e.replace(o,u);s.replace(n)}function h(){var e=s.findNext();if(!e){a=true}else if(jt(s.from(),r,i)){t.scrollIntoView(s.from(),30);t.setSelection(s.from(),s.to());f=s.from();a=false}else{a=true}}function p(e){if(e){e()}t.focus();if(f){t.setCursor(f);var n=t.state.vim;n.exMode=false;n.lastHPos=n.lastHSPos=f.ch}}function d(n,r,i){e.e_stop(n);var s=e.keyName(n);switch(s){case"Y":c();h();break;case"N":h();break;case"A":t.operation(l);break;case"L":c();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":p(i);break}if(a){p(i)}}t.state.vim.exMode=true;var a=false;var f=s.from();h();if(a){kt(t,"No matches for "+o.source);return}if(!n){l();return}Ot(t,{prefix:"replace with <strong>"+u+"</strong> (y/n/a/q/l)",onKeyDown:d})}function Wt(){function t(e,t){var n=e;if(E(n)&&t=="Ctrl"){n=n.toLowerCase()}if(t){n=t.charAt(0)+"-"+n}var r={Enter:"CR",Backspace:"BS",Delete:"Del"}[n];n=r?r:n;n=n.length>1?"<"+n+">":n;return n}function n(t){return function(n){e.Vim.handleKey(n,t)}}function i(e,i){for(var s=0;s<e.length;s++){var o=e[s];if(!i&&o.length==1){o="'"+o+"'"}var u=t(e[s],i);var a=i?i+"-"+o:o;r[a]=n(u)}}var r={nofallthrough:true,style:"fat-cursor"};i(l);i(c);i(l,"Ctrl");i(p);i(p,"Ctrl");i(h);i(h,"Ctrl");i(d);i(d,"Ctrl");return r}function Xt(t){var n=t.state.vim;var r=_.macroModeState;var i=_.registerController.getRegister(".");var s=r.isPlaying;if(!s){t.off("change",Qt);e.off(t.getInputField(),"keydown",Zt)}if(!s&&n.insertModeRepeat>1){en(t,n,n.insertModeRepeat-1,true);n.lastEditInputState.repeatOverride=n.insertModeRepeat}delete n.insertModeRepeat;n.insertMode=false;t.setCursor(t.getCursor().line,t.getCursor().ch-1);t.setOption("keyMap","vim");t.setOption("disableInput",true);t.toggleOverwrite(false);i.setText(r.lastInsertModeChanges.changes.join(""));e.signal(t,"vim-mode-change",{mode:"normal"});if(r.isRecording){Jt(r)}}function Vt(t,n,r,i){var s=_.registerController.getRegister(i);var o=s.keyBuffer;var u=0;r.isPlaying=true;r.replaySearchQueries=s.searchQueries.slice(0);for(var a=0;a<o.length;a++){var f=o[a];var l,c;while(f){l=/<\w+-.+?>|<\w+>|./.exec(f);c=l[0];f=f.substring(l.index+c.length);e.Vim.handleKey(t,c);if(n.insertMode){tn(t,s.insertModeChanges[u++].changes,1);Xt(t)}}}r.isPlaying=false}function $t(e,t){if(e.isPlaying){return}var n=e.latestRegister;var r=_.registerController.getRegister(n);if(r){r.pushText(t)}}function Jt(e){if(e.isPlaying){return}var t=e.latestRegister;var n=_.registerController.getRegister(t);if(n){n.pushInsertModeChanges(e.lastInsertModeChanges)}}function Kt(e,t){if(e.isPlaying){return}var n=e.latestRegister;var r=_.registerController.getRegister(n);if(r){r.pushSearchQuery(t)}}function Qt(e,t){var n=_.macroModeState;var r=n.lastInsertModeChanges;if(!n.isPlaying){while(t){r.expectCursorActivityForChange=true;if(t.origin=="+input"||t.origin=="paste"||t.origin===undefined){var i=t.text.join("\n");r.changes.push(i)}t=t.next}}}function Gt(e,t){var n=e.state.vim;if(n.insertMode){var r=_.macroModeState;if(r.isPlaying){return}var i=r.lastInsertModeChanges;if(i.expectCursorActivityForChange){i.expectCursorActivityForChange=false}else{i.changes=[]}}else if(t=="*mouse"){n.lastHPos=e.doc.getCursor().ch}}function Yt(e){this.keyName=e}function Zt(t){function s(){r.changes.push(new Yt(i));return true}var n=_.macroModeState;var r=n.lastInsertModeChanges;var i=e.keyName(t);if(i.indexOf("Delete")!=-1||i.indexOf("Backspace")!=-1){e.lookupKey(i,["vim-insert"],s)}}function en(e,t,n,r){function u(){if(s){F.processAction(e,t,t.lastEditActionCommand)}else{F.evalInput(e,t)}}function a(n){if(i.lastInsertModeChanges.changes.length>0){n=!t.lastEditActionCommand?1:n;var r=i.lastInsertModeChanges;i.lastInsertModeChanges={};tn(e,r.changes,n);i.lastInsertModeChanges=r}}var i=_.macroModeState;i.isPlaying=true;var s=!!t.lastEditActionCommand;var o=t.inputState;t.inputState=t.lastEditInputState;if(s&&t.lastEditActionCommand.interlaceInsertRepeat){for(var f=0;f<n;f++){u();a(1)}}else{if(!r){u()}a(n)}t.inputState=o;if(t.insertMode&&!r){Xt(e)}i.isPlaying=false}function tn(t,n,r){function i(n){if(typeof n=="string"){e.commands[n](t)}else{n(t)}return true}for(var s=0;s<r;s++){for(var o=0;o<n.length;o++){var u=n[o];if(u instanceof Yt){e.lookupKey(u.keyName,["vim-insert"],i)}else{var a=t.getCursor();t.replaceRange(u,a,a)}}}}e.defineOption("vimMode",false,function(t,n){if(n){t.setOption("keyMap","vim");t.setOption("disableInput",true);e.signal(t,"vim-mode-change",{mode:"normal"});t.on("beforeSelectionChange",i);t.on("cursorActivity",Gt);M(t);e.on(t.getInputField(),"paste",s(t))}else if(t.state.vim){t.setOption("keyMap","default");t.setOption("disableInput",false);t.off("beforeSelectionChange",i);t.off("cursorActivity",Gt);e.off(t.getInputField(),"paste",s(t));t.state.vim=null}});var o=/[\d]/;var u=[/\w/,/[^\w\s]/],a=[/\S/];var l=f(65,26);var c=f(97,26);var h=f(48,10);var p="~`!@#$%^&*()_-+=[{}]\\|/?.,<>:;\"'".split("");var d=["Left","Right","Up","Down","Space","Backspace","Esc","Home","End","PageUp","PageDown","Enter"];var v=[].concat(l,c,h,["<",">"]);var m=[].concat(l,c,h,["-",'"',".",":"]);var T={};var L=function(){function s(s,o,u){function l(n){var r=++t%e;var o=i[r];if(o){o.clear()}i[r]=s.setBookmark(n)}var a=t%e;var f=i[a];if(f){var c=f.find();if(c&&!J(c,o)){l(o)}}else{l(o)}l(u);n=t;r=t-e+1;if(r<0){r=0}}function o(s,o){t+=o;if(t>n){t=n}else if(t<r){t=r}var u=i[(e+t)%e];if(u&&!u.find()){var a=o>0?1:-1;var f;var l=s.getCursor();do{t+=a;u=i[(e+t)%e];if(u&&(f=u.find())&&!J(l,f)){break}}while(t<n&&t>r)}return u}var e=100;var t=-1;var n=0;var r=0;var i=new Array(e);return{cachedCursor:undefined,add:s,move:o}};var A=function(e){if(e){return{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}}return{changes:[],expectCursorActivityForChange:false}};O.prototype={exitMacroRecordMode:function(){var e=_.macroModeState;e.onRecordingDone();e.onRecordingDone=undefined;e.isRecording=false},enterMacroRecordMode:function(e,t){var n=_.registerController.getRegister(t);if(n){n.clear();this.latestRegister=t;this.onRecordingDone=e.openDialog("(recording)["+t+"]",null,{bottom:true});this.isRecording=true}}};var _;var P={buildKeyMap:function(){},getRegisterController:function(){return _.registerController},resetVimGlobalState_:D,getVimGlobalState_:function(){return _},maybeInitVimState_:M,InsertModeKey:Yt,map:function(e,t,n){Ut.map(e,t,n)},setOption:C,getOption:k,defineOption:N,defineEx:function(e,t,n){if(e.indexOf(t)!==0){throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered')}Rt[e]=n;Ut.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(n,r){var i;var s=M(n);var o=_.macroModeState;if(o.isRecording){if(r=="q"){o.exitMacroRecordMode();s.inputState=new H;return}}if(r=="<Esc>"){s.inputState=new H;if(s.visualMode){tt(n)}return}if(!s.visualMode&&!J(n.getCursor("head"),n.getCursor("anchor"))){s.visualMode=true;s.visualLine=false;e.signal(n,"vim-mode-change",{mode:"visual"});n.on("mousedown",tt)}if(r!="0"||r=="0"&&s.inputState.getRepeat()===0){i=F.matchCommand(r,t,s)}if(!i){if(w(r)){s.inputState.pushRepeatDigit(r)}if(o.isRecording){$t(o,r)}return}if(i.type=="keyToKey"){for(var u=0;u<i.toKeys.length;u++){this.handleKey(n,i.toKeys[u])}}else{if(o.isRecording){$t(o,r)}F.processCommand(n,s,i)}},handleEx:function(e,t){Ut.processCommand(e,t)}};H.prototype.pushRepeatDigit=function(e){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(e)}else{this.motionRepeat=this.motionRepeat.concat(e)}};H.prototype.getRepeat=function(){var e=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){e=1;if(this.prefixRepeat.length>0){e*=parseInt(this.prefixRepeat.join(""),10)}if(this.motionRepeat.length>0){e*=parseInt(this.motionRepeat.join(""),10)}}return e};B.prototype={setText:function(e,t){this.keyBuffer=[e||""];this.linewise=!!t},pushText:function(e,t){if(t){if(!this.linewise){this.keyBuffer.push("\n")}this.linewise=true}this.keyBuffer.push(e)},pushInsertModeChanges:function(e){this.insertModeChanges.push(A(e))},pushSearchQuery:function(e){this.searchQueries.push(e)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=false},toString:function(){return this.keyBuffer.join("")}};j.prototype={pushText:function(e,t,n,r){if(r&&n.charAt(0)=="\n"){n=n.slice(1)+"\n"}if(r&&n.charAt(n.length-1)!=="\n"){n+="\n"}var i=this.isValidRegister(e)?this.getRegister(e):null;if(!i){switch(t){case"yank":this.registers["0"]=new B(n,r);break;case"delete":case"change":if(n.indexOf("\n")==-1){this.registers["-"]=new B(n,r)}else{this.shiftNumericRegisters_();this.registers["1"]=new B(n,r)}break}this.unnamedRegister.setText(n,r);return}var s=E(e);if(s){i.pushText(n,r)}else{i.setText(n,r)}this.unnamedRegister.setText(i.toString(),r)},getRegister:function(e){if(!this.isValidRegister(e)){return this.unnamedRegister}e=e.toLowerCase();if(!this.registers[e]){this.registers[e]=new B}return this.registers[e]},isValidRegister:function(e){return e&&x(e,m)},shiftNumericRegisters_:function(){for(var e=9;e>=2;e--){this.registers[e]=this.getRegister(""+(e-1))}}};var F={matchCommand:function(e,t,n){function f(t){if(i.length<t.keys.length){r.keyBuffer.push(e);return null}else{if(t.keys[i.length-1]=="character"){r.selectedCharacter=o}r.keyBuffer=[];return t}}var r=n.inputState;var i=r.keyBuffer.concat(e);var s=[];var o;for(var u=0;u<t.length;u++){var a=t[u];if(X(i,a.keys)){if(r.operator&&a.type=="action"){continue}if(a.keys[i.length-1]=="character"){o=i[i.length-1];if(o.length>1){switch(o){case"<CR>":o="\n";break;case"<Space>":o=" ";break;default:continue}}}s.push(a)}}if(!s.length){r.keyBuffer=[];return null}else if(s.length==1){return f(s[0])}else{var l=n.visualMode?"visual":"normal";var c;for(var u=0;u<s.length;u++){var h=s[u];if(h.context==l){c=h;break}else if(!c&&!h.context){c=h}}return f(c)}},processCommand:function(e,t,n){t.inputState.repeatOverride=n.repeatOverride;switch(n.type){case"motion":this.processMotion(e,t,n);break;case"operator":this.processOperator(e,t,n);break;case"operatorMotion":this.processOperatorMotion(e,t,n);break;case"action":this.processAction(e,t,n);break;case"search":this.processSearch(e,t,n);break;case"ex":case"keyToEx":this.processEx(e,t,n);break;default:break}},processMotion:function(e,t,n){t.inputState.motion=n.motion;t.inputState.motionArgs=z(n.motionArgs);this.evalInput(e,t)},processOperator:function(e,t,n){var r=t.inputState;if(r.operator){if(r.operator==n.operator){r.motion="expandToLine";r.motionArgs={linewise:true};this.evalInput(e,t);return}else{t.inputState=new H}}r.operator=n.operator;r.operatorArgs=z(n.operatorArgs);if(t.visualMode){this.evalInput(e,t)}},processOperatorMotion:function(e,t,n){var r=t.visualMode;var i=z(n.operatorMotionArgs);if(i){if(r&&i.visualLine){t.visualLine=true}}this.processOperator(e,t,n);if(!r){this.processMotion(e,t,n)}},processAction:function(e,t,n){var r=t.inputState;var i=r.getRepeat();var s=!!i;var o=z(n.actionArgs)||{};if(r.selectedCharacter){o.selectedCharacter=r.selectedCharacter}if(n.operator){this.processOperator(e,t,n)}if(n.motion){this.processMotion(e,t,n)}if(n.motion||n.operator){this.evalInput(e,t)}o.repeat=i||1;o.repeatIsExplicit=s;o.registerName=r.registerName;t.inputState=new H;t.lastMotion=null;if(n.isEdit){this.recordLastEdit(t,r,n)}R[n.action](e,o,t)},processSearch:function(t,n,r){function f(e,i,s){try{_t(t,e,i,s)}catch(o){kt(t,"Invalid regex: "+e);return}F.processMotion(t,n,{type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:r.searchArgs.toJumplist}})}function l(e){t.scrollTo(a.left,a.top);f(e,true,true);var n=_.macroModeState;if(n.isRecording){Kt(n,e)}}function c(e,n){var r;try{r=_t(t,n,true,true)}catch(s){}if(r){t.scrollIntoView(Ht(t,!i,r),30)}else{Bt(t);t.scrollTo(a.left,a.top)}}function h(n,r,i){var s=e.keyName(n);if(s=="Esc"||s=="Ctrl-C"||s=="Ctrl-["){_t(t,u);Bt(t);t.scrollTo(a.left,a.top);e.e_stop(n);i();t.focus()}}if(!t.getSearchCursor){return}var i=r.searchArgs.forward;var s=r.searchArgs.wholeWordOnly;wt(t).setReversed(!i);var o=i?"/":"?";var u=wt(t).getQuery();var a=t.getScrollInfo();switch(r.searchArgs.querySrc){case"prompt":var p=_.macroModeState;if(p.isPlaying){var d=p.replaySearchQueries.shift();f(d,true,false)}else{Ot(t,{onClose:l,prefix:o,desc:At,onKeyUp:c,onKeyDown:h})}break;case"wordUnderCursor":var v=st(t,false,true,false,true);var m=true;if(!v){v=st(t,false,true,false,false);m=false}if(!v){return}var d=t.getLine(v.start.line).substring(v.start.ch,v.end.ch);if(m&&s){d="\\b"+d+"\\b"}else{d=et(d)}_.jumpList.cachedCursor=t.getCursor();t.setCursor(v.start);f(d,true,false);break}},processEx:function(t,n,r){function i(e){Ut.processCommand(t,e)}function s(n,r,i){var s=e.keyName(n);if(s=="Esc"||s=="Ctrl-C"||s=="Ctrl-["){e.e_stop(n);i();t.focus()}}if(r.type=="keyToEx"){Ut.processCommand(t,r.exArgs.input)}else{if(n.visualMode){Ot(t,{onClose:i,prefix:":",value:"'<,'>",onKeyDown:s})}else{Ot(t,{onClose:i,prefix:":",onKeyDown:s})}}},evalInput:function(e,t){var r=t.inputState;var i=r.motion;var s=r.motionArgs||{};var o=r.operator;var u=r.operatorArgs||{};var a=r.registerName;var f=$(e.getCursor("head"));var l=$(e.getCursor("anchor"));var c=$(f);var h=$(c);var p;var d;if(o){this.recordLastEdit(t,r)}if(r.repeatOverride!==undefined){d=r.repeatOverride}else{d=r.getRepeat()}if(d>0&&s.explicitRepeat){s.repeatIsExplicit=true}else if(s.noRepeat||!s.explicitRepeat&&d===0){d=1;s.repeatIsExplicit=false}if(r.selectedCharacter){s.selectedCharacter=u.selectedCharacter=r.selectedCharacter}s.repeat=d;t.inputState=new H;if(i){var v=I[i](e,s,t);t.lastMotion=I[i];if(!v){return}if(s.toJumplist){var m=_.jumpList;var g=m.cachedCursor;if(g){ot(e,g,v);delete m.cachedCursor}else{ot(e,h,v)}}if(v instanceof Array){c=v[0];p=v[1]}else{p=v}if(!p){p=n(c.line,c.ch)}if(t.visualMode){if(K(l,f)&&(J(l,p)||K(p,l))){l.ch+=1}else if(K(f,l)&&(J(l,p)||K(l,p))){l.ch-=1}f=p;l=v instanceof Array?c:l;if(t.visualLine){if(K(l,f)){l.ch=0;var y=e.lastLine();if(f.line>y){f.line=y}f.ch=G(e,f.line)}else{f.ch=0;l.ch=G(e,l.line)}}e.setSelection(l,f);vt(e,t,"<",K(l,f)?l:f);vt(e,t,">",K(l,f)?f:l)}else if(!o){p=U(e,p);e.setCursor(p.line,p.ch)}}if(o){var b=false;t.lastMotion=null;u.repeat=d;if(t.visualMode){c=l;p=f;s.inclusive=true}if(K(p,c)){var w=c;c=p;p=w;b=true}if(s.inclusive&&!(t.visualMode&&b)){p.ch++}var E=s.linewise||t.visualMode&&t.visualLine;if(E){rt(e,c,p)}else if(s.forward){nt(e,c,p)}u.registerName=a;u.linewise=E;q[o](e,u,t,c,p,h);if(t.visualMode){tt(e)}}},recordLastEdit:function(e,t,n){var r=_.macroModeState;if(r.isPlaying){return}e.lastEditInputState=t;e.lastEditActionCommand=n;r.lastInsertModeChanges.changes=[];r.lastInsertModeChanges.expectCursorActivityForChange=false}};var I={moveToTopLine:function(e,t){var r=Ft(e).top+t.repeat-1;return n(r,it(e.getLine(r)))},moveToMiddleLine:function(e){var t=Ft(e);var r=Math.floor((t.top+t.bottom)*.5);return n(r,it(e.getLine(r)))},moveToBottomLine:function(e,t){var r=Ft(e).bottom-t.repeat+1;return n(r,it(e.getLine(r)))},expandToLine:function(e,t){var r=e.getCursor();return n(r.line+t.repeat-1,Infinity)},findNext:function(e,t){var n=wt(e);var r=n.getQuery();if(!r){return}var i=!t.forward;i=n.isReversed()?!i:i;Pt(e,r);return Ht(e,i,r,t.repeat)},goToMark:function(e,t,n){var r=n.marks[t.selectedCharacter];if(r){var i=r.find();return t.linewise?{line:i.line,ch:it(e.getLine(i.line))}:i}return null},moveToOtherHighlightedEnd:function(e){var t=$(e.getCursor("head"));var n=$(e.getCursor("anchor"));if(K(n,t)){t.ch+=1}else if(K(t,n)){n.ch-=1}return[t,n]},jumpToMark:function(e,t,r){var i=e.getCursor();for(var s=0;s<t.repeat;s++){var o=i;for(var u in r.marks){if(!y(u)){continue}var a=r.marks[u].find();var f=t.forward?K(a,o):K(o,a);if(f){continue}if(t.linewise&&a.line==o.line){continue}var l=J(o,i);var c=t.forward?Q(o,a,i):Q(i,a,o);if(l||c){i=a}}}if(t.linewise){i=n(i.line,it(e.getLine(i.line)))}return i},moveByCharacters:function(e,t){var r=e.getCursor();var i=t.repeat;var s=t.forward?r.ch+i:r.ch-i;return n(r.line,s)},moveByLines:function(e,t,r){var i=e.getCursor();var s=i.ch;switch(r.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:s=r.lastHPos;break;default:r.lastHPos=s}var o=t.repeat+(t.repeatOffset||0);var u=t.forward?i.line+o:i.line-o;var a=e.firstLine();var f=e.lastLine();if(u<a&&i.line==a||u>f&&i.line==f){return}if(t.toFirstChar){s=it(e.getLine(u));r.lastHPos=s}r.lastHSPos=e.charCoords(n(u,s),"div").left;return n(u,s)},moveByDisplayLines:function(e,t,r){var i=e.getCursor();switch(r.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:r.lastHSPos=e.charCoords(i,"div").left}var s=t.repeat;var o=e.findPosV(i,t.forward?s:-s,"line",r.lastHSPos);if(o.hitSide){if(t.forward){var u=e.charCoords(o,"div");var a={top:u.top+8,left:r.lastHSPos};var o=e.coordsChar(a,"div")}else{var f=e.charCoords(n(e.firstLine(),0),"div");f.left=r.lastHSPos;o=e.coordsChar(f,"div")}}r.lastHPos=o.ch;return o},moveByPage:function(e,t){var n=e.getCursor();var r=t.repeat;e.moveV(t.forward?r:-r,"page");var i=e.getCursor();e.setCursor(n);return i},moveByParagraph:function(e,t){var r=e.getCursor().line;var i=t.repeat;var s=t.forward?1:-1;for(var o=0;o<i;o++){if(!t.forward&&r===e.firstLine()||t.forward&&r==e.lastLine()){break}r+=s;while(r!==e.firstLine()&&r!=e.lastLine()&&e.getLine(r)){r+=s}}return n(r,0)},moveByScroll:function(e,t,n){var r=e.getScrollInfo();var i=null;var s=t.repeat;if(!s){s=r.clientHeight/(2*e.defaultTextHeight())}var o=e.charCoords(e.getCursor(),"local");t.repeat=s;var i=I.moveByDisplayLines(e,t,n);if(!i){return null}var u=e.charCoords(i,"local");e.scrollTo(null,r.top+u.top-o.top);return i},moveByWords:function(e,t){return ht(e,t.repeat,!!t.forward,!!t.wordEnd,!!t.bigWord)},moveTillCharacter:function(e,t){var n=t.repeat;var r=pt(e,n,t.forward,t.selectedCharacter);var i=t.forward?-1:1;ut(i,t);if(!r)return null;r.ch+=i;return r},moveToCharacter:function(e,t){var n=t.repeat;ut(0,t);return pt(e,n,t.forward,t.selectedCharacter)||e.getCursor()},moveToSymbol:function(e,t){var n=t.repeat;return lt(e,n,t.forward,t.selectedCharacter)||e.getCursor()},moveToColumn:function(e,t,n){var r=t.repeat;n.lastHPos=r-1;n.lastHSPos=e.charCoords(e.getCursor(),"div").left;return dt(e,r)},moveToEol:function(e,t,r){var i=e.getCursor();r.lastHPos=Infinity;var s=n(i.line+t.repeat-1,Infinity);var o=e.clipPos(s);o.ch--;r.lastHSPos=e.charCoords(o,"div").left;return s},moveToFirstNonWhiteSpaceCharacter:function(e){var t=e.getCursor();return n(t.line,it(e.getLine(t.line)))},moveToMatchedSymbol:function(e){var t=e.getCursor();var r=t.line;var i=t.ch;var s=e.getLine(r);var o;do{o=s.charAt(i++);if(o&&b(o)){var u=["string","comment"];var a=e.getTokenTypeAt(n(r,i));if(u.indexOf(a)<0){break}}}while(o);if(o){var f=e.findMatchingBracket(n(r,i-1));return f.to}else{return t}},moveToStartOfLine:function(e){var t=e.getCursor();return n(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t){var r=t.forward?e.lastLine():e.firstLine();if(t.repeatIsExplicit){r=t.repeat-e.getOption("firstLineNumber")}return n(r,it(e.getLine(r)))},textObjectManipulation:function(e,t){var n={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["};var r={"'":true,'"':true};var i=t.selectedCharacter;if(i=="b"){i="("}else if(i=="B"){i="{"}var s=!t.textObjectInner;var o;if(n[i]){o=gt(e,i,s)}else if(r[i]){o=yt(e,i,s)}else if(i==="W"){o=st(e,s,true,true)}else if(i==="w"){o=st(e,s,true,false)}else{return null}return[o.start,o.end]},repeatLastCharacterSearch:function(e,t){var n=_.lastChararacterSearch;var r=t.repeat;var i=t.forward===n.forward;var s=(n.increment?1:0)*(i?-1:1);e.moveH(-s,"char");t.inclusive=i?true:false;var o=pt(e,r,i,n.selectedCharacter);if(!o){e.moveH(s,"char");return e.getCursor()}o.ch+=s;return o}};var q={change:function(e,t,n,r,i){_.registerController.pushText(t.registerName,"change",e.getRange(r,i),t.linewise);if(t.linewise){var s=i.line>e.lastLine()?"":"\n";e.replaceRange(s,r,i);e.indentLine(r.line,"smart");r.ch=null}else{var o=e.getRange(r,i);if(!S(o)){var u=/\s+$/.exec(o);if(u){i=W(i,0,-u[0].length)}}e.replaceRange("",r,i)}R.enterInsertMode(e,{},e.state.vim);e.setCursor(r)},"delete":function(e,t,n,r,i){if(t.linewise&&i.line>e.lastLine()&&r.line>e.firstLine()){r.line--;r.ch=G(e,r.line)}_.registerController.pushText(t.registerName,"delete",e.getRange(r,i),t.linewise);e.replaceRange("",r,i);if(t.linewise){e.setCursor(I.moveToFirstNonWhiteSpaceCharacter(e))}else{e.setCursor(r)}},indent:function(e,t,n,r,i){var s=r.line;var o=i.line;var u=n.visualMode?t.repeat:1;if(t.linewise){o--}for(var a=s;a<=o;a++){for(var f=0;f<u;f++){e.indentLine(a,t.indentRight)}}e.setCursor(r);e.setCursor(I.moveToFirstNonWhiteSpaceCharacter(e))},swapcase:function(e,t,n,r,i,s){var o=e.getRange(r,i);var u="";for(var a=0;a<o.length;a++){var f=o.charAt(a);u+=E(f)?f.toLowerCase():f.toUpperCase()}e.replaceRange(u,r,i);if(!t.shouldMoveCursor){e.setCursor(s)}},yank:function(e,t,n,r,i,s){_.registerController.pushText(t.registerName,"yank",e.getRange(r,i),t.linewise);e.setCursor(s)}};var R={jumpListWalk:function(e,t,n){if(n.visualMode){return}var r=t.repeat;var i=t.forward;var s=_.jumpList;var o=s.move(e,i?r:-r);var u=o?o.find():undefined;u=u?u:e.getCursor();e.setCursor(u)},scroll:function(e,t,n){if(n.visualMode){return}var r=t.repeat||1;var i=e.defaultTextHeight();var s=e.getScrollInfo().top;var o=i*r;var u=t.forward?s+o:s-o;var a=$(e.getCursor());var f=e.charCoords(a,"local");if(t.forward){if(u>f.top){a.line+=(u-f.top)/i;a.line=Math.ceil(a.line);e.setCursor(a);f=e.charCoords(a,"local");e.scrollTo(null,f.top)}else{e.scrollTo(null,u)}}else{var l=u+e.getScrollInfo().clientHeight;if(l<f.bottom){a.line-=(f.bottom-l)/i;a.line=Math.floor(a.line);e.setCursor(a);f=e.charCoords(a,"local");e.scrollTo(null,f.bottom-e.getScrollInfo().clientHeight)}else{e.scrollTo(null,u)}}},scrollToCursor:function(e,t){var r=e.getCursor().line;var i=e.charCoords(n(r,0),"local");var s=e.getScrollInfo().clientHeight;var o=i.top;var u=i.bottom-o;switch(t.position){case"center":o=o-s/2+u;break;case"bottom":o=o-s+u*1.4;break;case"top":o=o+u*.4;break}e.scrollTo(null,o)},replayMacro:function(e,t,n){var r=t.selectedCharacter;var i=t.repeat;var s=_.macroModeState;if(r=="@"){r=s.latestRegister}while(i--){Vt(e,n,s,r)}},enterMacroRecordMode:function(e,t){var n=_.macroModeState;var r=t.selectedCharacter;n.enterMacroRecordMode(e,r)},enterInsertMode:function(t,r,i){if(t.getOption("readOnly")){return}i.insertMode=true;i.insertModeRepeat=r&&r.repeat||1;var s=r?r.insertAt:null;if(s=="eol"){var o=t.getCursor();o=n(o.line,G(t,o.line));t.setCursor(o)}else if(s=="charAfter"){t.setCursor(W(t.getCursor(),0,1))}else if(s=="firstNonBlank"){t.setCursor(I.moveToFirstNonWhiteSpaceCharacter(t))}t.setOption("keyMap","vim-insert");t.setOption("disableInput",false);if(r&&r.replace){t.toggleOverwrite(true);t.setOption("keyMap","vim-replace");e.signal(t,"vim-mode-change",{mode:"replace"})}else{t.setOption("keyMap","vim-insert");e.signal(t,"vim-mode-change",{mode:"insert"})}if(!_.macroModeState.isPlaying){t.on("change",Qt);e.on(t.getInputField(),"keydown",Zt)}},toggleVisualMode:function(t,r,i){var s=r.repeat;var o=t.getCursor();var u;if(!i.visualMode){t.on("mousedown",tt);i.visualMode=true;i.visualLine=!!r.linewise;if(i.visualLine){o.ch=0;u=U(t,n(o.line+s-1,G(t,o.line)),true)}else{u=U(t,n(o.line,o.ch+s),true)}if(!r.repeatIsExplicit&&!i.visualLine){t.setCursor(u);t.setSelection(u,o)}else{t.setSelection(o,u)}e.signal(t,"vim-mode-change",{mode:"visual",subMode:i.visualLine?"linewise":""})}else{o=t.getCursor("anchor");u=t.getCursor("head");if(!i.visualLine&&r.linewise){i.visualLine=true;o.ch=K(o,u)?0:G(t,o.line);u.ch=K(o,u)?G(t,u.line):0;t.setSelection(o,u);e.signal(t,"vim-mode-change",{mode:"visual",subMode:"linewise"})}else if(i.visualLine&&!r.linewise){i.visualLine=false;e.signal(t,"vim-mode-change",{mode:"visual"})}else{tt(t)}}vt(t,i,"<",K(o,u)?o:u);vt(t,i,">",K(o,u)?u:o)},reselectLastSelection:function(t,n,r){if(r.lastSelection){var i=r.lastSelection;t.setSelection(i.curStart,i.curEnd);if(i.visualLine){r.visualMode=true;r.visualLine=true}else{r.visualMode=true;r.visualLine=false}e.signal(t,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":""})}},joinLines:function(e,t,r){var i,s;if(r.visualMode){i=e.getCursor("anchor");s=e.getCursor("head");s.ch=G(e,s.line)-1}else{var o=Math.max(t.repeat,2);i=e.getCursor();s=U(e,n(i.line+o-1,Infinity))}var u=0;e.operation(function(){for(var t=i.line;t<s.line;t++){u=G(e,i.line);var r=n(i.line+1,G(e,i.line+1));var o=e.getRange(i,r);o=o.replace(/\n\s*/g," ");e.replaceRange(o,i,r)}var a=n(i.line,u);e.setCursor(a)})},newLineAndEnterInsertMode:function(t,r,i){i.insertMode=true;var s=$(t.getCursor());if(s.line===t.firstLine()&&!r.after){t.replaceRange("\n",n(t.firstLine(),0));t.setCursor(t.firstLine(),0)}else{s.line=r.after?s.line:s.line-1;s.ch=G(t,s.line);t.setCursor(s);var o=e.commands.newlineAndIndentContinueComment||e.commands.newlineAndIndent;o(t)}this.enterInsertMode(t,{repeat:r.repeat},i)},paste:function(e,t){var r=$(e.getCursor());var i=_.registerController.getRegister(t.registerName);var s=i.toString();if(!s){return}if(t.matchIndent){var o=function(t){var n=t.split("	").length-1;var r=t.split(" ").length-1;return n*e.options.tabSize+r*1};var u=e.getLine(e.getCursor().line);var a=o(u.match(/^\s*/)[0]);var f=s.replace(/\n$/,"");var l=s!==f;var c=o(s.match(/^\s*/)[0]);var s=f.replace(/^\s*/gm,function(t){var n=a+(o(t)-c);if(n<0){return""}else if(e.options.indentWithTabs){var r=Math.floor(n/e.options.tabSize);return Array(r+1).join("	")}else{return Array(n+1).join(" ")}});s+=l?"\n":""}if(t.repeat>1){var s=Array(t.repeat+1).join(s)}var h=i.linewise;if(h){if(t.after){s="\n"+s.slice(0,s.length-1);r.ch=G(e,r.line)}else{r.ch=0}}else{r.ch+=t.after?1:0}e.replaceRange(s,r);var p;var d;if(h&&t.after){p=n(r.line+1,it(e.getLine(r.line+1)))}else if(h&&!t.after){p=n(r.line,it(e.getLine(r.line)))}else if(!h&&t.after){d=e.indexFromPos(r);p=e.posFromIndex(d+s.length-1)}else{d=e.indexFromPos(r);p=e.posFromIndex(d+s.length)}e.setCursor(p)},undo:function(t,n){t.operation(function(){V(t,e.commands.undo,n.repeat)();t.setCursor(t.getCursor("anchor"))})},redo:function(t,n){V(t,e.commands.redo,n.repeat)()},setRegister:function(e,t,n){n.inputState.registerName=t.selectedCharacter},setMark:function(e,t,n){var r=t.selectedCharacter;vt(e,n,r,e.getCursor())},replace:function(t,r,i){var s=r.selectedCharacter;var o=t.getCursor();var u;var a;if(i.visualMode){o=t.getCursor("start");a=t.getCursor("end");a=t.clipPos(n(a.line,a.ch+1))}else{var f=t.getLine(o.line);u=o.ch+r.repeat;if(u>f.length){u=f.length}a=n(o.line,u)}if(s=="\n"){if(!i.visualMode)t.replaceRange("",o,a);(e.commands.newlineAndIndentContinueComment||e.commands.newlineAndIndent)(t)}else{var l=t.getRange(o,a);l=l.replace(/[^\n]/g,s);t.replaceRange(l,o,a);if(i.visualMode){t.setCursor(o);tt(t)}else{t.setCursor(W(a,0,-1))}}},incrementNumberToken:function(e,t){var r=e.getCursor();var i=e.getLine(r.line);var s=/-?\d+/g;var o;var u;var a;var f;var l;while((o=s.exec(i))!==null){l=o[0];u=o.index;a=u+l.length;if(r.ch<a)break}if(!t.backtrack&&a<=r.ch)return;if(l){var c=t.increase?1:-1;var h=parseInt(l)+c*t.repeat;var p=n(r.line,u);var d=n(r.line,a);f=h.toString();e.replaceRange(f,p,d)}else{return}e.setCursor(n(r.line,u+f.length-1))},repeatLastEdit:function(e,t,n){var r=n.lastEditInputState;if(!r){return}var i=t.repeat;if(i&&t.repeatIsExplicit){n.lastEditInputState.repeatOverride=i}else{i=n.lastEditInputState.repeatOverride||i}en(e,n,i,false)}};var at={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var ft={bracket:{isComplete:function(e){if(e.nextCh===e.symb){e.depth++;if(e.depth>=1)return true}else if(e.nextCh===e.reverseSymb){e.depth--}return false}},section:{init:function(e){e.curMoveThrough=true;e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return e.index===0&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t=e.lastCh==="*"&&e.nextCh==="/";e.lastCh=e.nextCh;return t}},method:{init:function(e){e.symb=e.symb==="m"?"{":"}";e.reverseSymb=e.symb==="{"?"}":"{"},isComplete:function(e){if(e.nextCh===e.symb)return true;return false}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if(e.nextCh==="#"){var t=e.lineText.match(/#(\w+)/)[1];if(t==="endif"){if(e.forward&&e.depth===0){return true}e.depth++}else if(t==="if"){if(!e.forward&&e.depth===0){return true}e.depth--}if(t==="else"&&e.depth===0)return true}return false}}};N("pcre",true,"boolean");bt.prototype={getQuery:function(){return _.query},setQuery:function(e){_.query=e},getOverlay:function(){return this.searchOverlay},setOverlay:function(e){this.searchOverlay=e},isReversed:function(){return _.isReversed},setReversed:function(e){_.isReversed=e}};var At="(Javascript regexp)";var It=[{name:"map"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"set"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s"},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:true}];r.ExCommandDispatcher=function(){this.buildCommandMap_()};r.ExCommandDispatcher.prototype={processCommand:function(t,n){var r=t.state.vim;var i=_.registerController.getRegister(":");var s=i.toString();if(r.visualMode){tt(t)}var o=new e.StringStream(n);i.setText(n);var u={};u.input=n;try{this.parseInput_(t,o,u)}catch(a){kt(t,a);throw a}var f;if(!u.commandName){if(u.line!==undefined){f="move"}}else{var l=this.matchCommand_(u.commandName);if(l){f=l.name;if(l.excludeFromCommandHistory){i.setText(s)}this.parseCommandArgs_(o,u,l);if(l.type=="exToKey"){for(var c=0;c<l.toKeys.length;c++){e.Vim.handleKey(t,l.toKeys[c])}return}else if(l.type=="exToEx"){this.processCommand(t,l.toInput);return}}}if(!f){kt(t,'Not an editor command ":'+n+'"');return}try{Rt[f](t,u)}catch(a){kt(t,a);throw a}},parseInput_:function(e,t,n){t.eatWhile(":");if(t.eat("%")){n.line=e.firstLine();n.lineEnd=e.lastLine()}else{n.line=this.parseLineSpec_(e,t);if(n.line!==undefined&&t.eat(",")){n.lineEnd=this.parseLineSpec_(e,t)}}var r=t.match(/^(\w+)/);if(r){n.commandName=r[1]}else{n.commandName=t.match(/.*/)[0]}return n},parseLineSpec_:function(e,t){var n=t.match(/^(\d+)/);if(n){return parseInt(n[1],10)-1}switch(t.next()){case".":return e.getCursor().line;case"$":return e.lastLine();case"'":var r=e.state.vim.marks[t.next()];if(r&&r.find()){return r.find().line}throw new Error("Mark not set");default:t.backUp(1);return undefined}},parseCommandArgs_:function(e,t,n){if(e.eol()){return}t.argString=e.match(/.*/)[0];var r=n.argDelimiter||/\s+/;var i=Z(t.argString).split(r);if(i.length&&i[0]){t.args=i}},matchCommand_:function(e){for(var t=e.length;t>0;t--){var n=e.substring(0,t);if(this.commandMap_[n]){var r=this.commandMap_[n];if(r.name.indexOf(e)===0){return r}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var e=0;e<It.length;e++){var t=It[e];var n=t.shortName||t.name;this.commandMap_[n]=t}},map:function(e,n,r){if(e!=":"&&e.charAt(0)==":"){if(r){throw Error("Mode not supported for ex mappings")}var i=e.substring(1);if(n!=":"&&n.charAt(0)==":"){this.commandMap_[i]={name:i,type:"exToEx",toInput:n.substring(1),user:true}}else{this.commandMap_[i]={name:i,type:"exToKey",toKeys:qt(n),user:true}}}else{if(n!=":"&&n.charAt(0)==":"){var s={keys:qt(e),type:"keyToEx",exArgs:{input:n.substring(1)},user:true};if(r){s.context=r}t.unshift(s)}else{var s={keys:qt(e),type:"keyToKey",toKeys:qt(n),user:true};if(r){s.context=r}t.unshift(s)}}},unmap:function(e,n){var r=function(e,t){if(e===t)return true;if(e==null||t==null)return true;if(e.length!=t.length)return false;for(var n=0;n<e.length;n++){if(e[n]!==t[n])return false}return true};if(e!=":"&&e.charAt(0)==":"){if(n){throw Error("Mode not supported for ex mappings")}var i=e.substring(1);if(this.commandMap_[i]&&this.commandMap_[i].user){delete this.commandMap_[i];return}}else{var s=qt(e);for(var o=0;o<t.length;o++){if(r(s,t[o].keys)&&t[o].context===n&&t[o].user){t.splice(o,1);return}}}throw Error("No such mapping.")}};var Rt={map:function(e,t,n){var r=t.args;if(!r||r.length<2){if(e){kt(e,"Invalid mapping: "+t.input)}return}Ut.map(r[0],r[1],n)},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},unmap:function(e,t,n){var r=t.args;if(!r||r.length<1){if(e){kt(e,"No such mapping: "+t.input)}return}Ut.unmap(r[0],n)},move:function(e,t){F.processCommand(e,e.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:t.line+1})},set:function(e,t){var n=t.args;if(!n||n.length<1){if(e){kt(e,"Invalid mapping: "+t.input)}return}var r=n[0].split("=");var i=r[0];var s=r[1];var o=false;if(i.charAt(i.length-1)=="?"){if(s){throw Error("Trailing characters: "+t.argString)}i=i.substring(0,i.length-1);o=true}if(s===undefined&&i.substring(0,2)=="no"){i=i.substring(2);s=false}var u=T[i]&&T[i].type=="boolean";if(u&&s==undefined){s=true}if(!u&&!s||o){var a=k(i);if(a===true||a===false){kt(e," "+(a?"":"no")+i)}else{kt(e,"  "+i+"="+a)}}else{C(i,s)}},registers:function(e,t){var n=t.args;var r=_.registerController.registers;var i="----------Registers----------<br><br>";if(!n){for(var s in r){var o=r[s].toString();if(o.length){i+='"'+s+"    "+o+"<br>"}}}else{var s;n=n.join("");for(var u=0;u<n.length;u++){s=n.charAt(u);if(!_.registerController.isValidRegister(s)){continue}var a=r[s]||new B;i+='"'+s+"    "+a.toString()+"<br>"}}kt(e,i)},sort:function(t,r){function a(){if(r.argString){var t=new e.StringStream(r.argString);if(t.eat("!")){i=true}if(t.eol()){return}if(!t.eatSpace()){return"Invalid arguments"}var n=t.match(/[a-z]+/);if(n){n=n[0];s=n.indexOf("i")!=-1;o=n.indexOf("u")!=-1;var a=n.indexOf("d")!=-1&&1;var f=n.indexOf("x")!=-1&&1;var l=n.indexOf("o")!=-1&&1;if(a+f+l>1){return"Invalid arguments"}u=a&&"decimal"||f&&"hex"||l&&"octal"}if(t.eatSpace()&&t.match(/\/.*\//)){"patterns not supported"}}}function w(e,t){if(i){var n;n=e;e=t;t=n}if(s){e=e.toLowerCase();t=t.toLowerCase()}var r=u&&v.exec(e);var o=u&&v.exec(t);if(!r){return e<t?-1:1}r=parseInt((r[1]+r[2]).toLowerCase(),m);o=parseInt((o[1]+o[2]).toLowerCase(),m);return r-o}var i,s,o,u;var f=a();if(f){kt(t,f+": "+r.argString);return}var l=r.line||t.firstLine();var c=r.lineEnd||r.line||t.lastLine();if(l==c){return}var h=n(l,0);var p=n(c,G(t,c));var d=t.getRange(h,p).split("\n");var v=u=="decimal"?/(-?)([\d]+)/:u=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:u=="octal"?/([0-7]+)/:null;var m=u=="decimal"?10:u=="hex"?16:u=="octal"?8:null;var g=[],y=[];if(u){for(var b=0;b<d.length;b++){if(v.exec(d[b])){g.push(d[b])}else{y.push(d[b])}}}else{y=d}g.sort(w);y.sort(w);d=!i?y.concat(g):g.concat(y);if(o){var E=d;var S;d=[];for(var b=0;b<E.length;b++){if(E[b]!=S){d.push(E[b])}S=E[b]}}t.replaceRange(d.join("\n"),h,p)},substitute:function(e,t){if(!e.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or "+"any other getSearchCursor implementation.")}var r=t.argString;var i=r?St(r):[];var s="";if(i.length){if(i[0]!==0){kt(e,"Substitutions should be of the form "+":s/pattern/replace/");return}var o=r.substring(i[0]+1,i[1]);var u;var a;var f=false;if(i[1]){s=r.substring(i[1]+1,i[2]);if(k("pcre")){s=Nt(s)}else{s=Tt(s)}_.lastSubstituteReplacePart=s}if(i[2]){var l=r.substring(i[2]+1).split(" ");u=l[0];a=parseInt(l[1])}if(u){if(u.indexOf("c")!=-1){f=true;u.replace("c","")}o=o+"/"+u}}if(o){try{_t(e,o,true,true)}catch(c){kt(e,"Invalid regex: "+o);return}}s=s||_.lastSubstituteReplacePart;if(s===undefined){kt(e,"No previous substitute regular expression");return}var h=wt(e);var p=h.getQuery();var d=t.line!==undefined?t.line:e.getCursor().line;var v=t.lineEnd||d;if(a){d=v;v=d+a-1}var m=U(e,n(d,0));var g=e.getSearchCursor(p,m);zt(e,f,d,v,g,p,s)},redo:e.commands.redo,undo:e.commands.undo,write:function(t){if(e.commands.save){e.commands.save(t)}else{t.save()}},nohlsearch:function(e){Bt(e)},delmarks:function(t,n){if(!n.argString||!Z(n.argString)){kt(t,"Argument required");return}var r=t.state.vim;var i=new e.StringStream(Z(n.argString));while(!i.eol()){i.eatSpace();var s=i.pos;if(!i.match(/[a-zA-Z]/,false)){kt(t,"Invalid argument: "+n.argString.substring(s));return}var o=i.next();if(i.match("-",true)){if(!i.match(/[a-zA-Z]/,false)){kt(t,"Invalid argument: "+n.argString.substring(s));return}var u=o;var a=i.next();if(y(u)&&y(a)||E(u)&&E(a)){var f=u.charCodeAt(0);var l=a.charCodeAt(0);if(f>=l){kt(t,"Invalid argument: "+n.argString.substring(s));return}for(var c=0;c<=l-f;c++){var h=String.fromCharCode(f+c);delete r.marks[h]}}else{kt(t,"Invalid argument: "+u+"-");return}}else{delete r.marks[o]}}}};var Ut=new r.ExCommandDispatcher;e.keyMap.vim=Wt();e.keyMap["vim-insert"]={Esc:Xt,"Ctrl-[":Xt,"Ctrl-C":Xt,"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(t){var n=e.commands.newlineAndIndentContinueComment||e.commands.newlineAndIndent;n(t)},fallthrough:["default"]};e.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"]};D();return P};e.Vim=r()})