(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("coffeescript",function(e){function n(e){return new RegExp("^(("+e.join(")|(")+"))\\b")}function v(e,n){if(e.sol()){if(n.scope.align===null)n.scope.align=false;var a=n.scope.offset;if(e.eatSpace()){var f=e.indentation();if(f>a&&n.scope.type=="coffee"){return"indent"}else if(f<a){return"dedent"}return null}else{if(a>0){b(e,n)}}}if(e.eatSpace()){return null}var p=e.peek();if(e.match("####")){e.skipToEnd();return"comment"}if(e.match("###")){n.tokenize=g;return n.tokenize(e,n)}if(p==="#"){e.skipToEnd();return"comment"}if(e.match(/^-?[0-9\.]/,false)){var v=false;if(e.match(/^-?\d*\.\d+(e[\+\-]?\d+)?/i)){v=true}if(e.match(/^-?\d+\.\d*/)){v=true}if(e.match(/^-?\.\d+/)){v=true}if(v){if(e.peek()=="."){e.backUp(1)}return"number"}var y=false;if(e.match(/^-?0x[0-9a-f]+/i)){y=true}if(e.match(/^-?[1-9]\d*(e[\+\-]?\d+)?/)){y=true}if(e.match(/^-?0(?![\dx])/i)){y=true}if(y){return"number"}}if(e.match(c)){n.tokenize=m(e.current(),false,"string");return n.tokenize(e,n)}if(e.match(h)){if(e.current()!="/"||e.match(/^.*\//,false)){n.tokenize=m(e.current(),true,"string-2");return n.tokenize(e,n)}else{e.backUp(1)}}if(e.match(r)||e.match(u)){return"operator"}if(e.match(i)){return"punctuation"}if(e.match(d)){return"atom"}if(e.match(l)){return"keyword"}if(e.match(s)){return"variable"}if(e.match(o)){return"property"}e.next();return t}function m(n,r,i){return function(s,o){while(!s.eol()){s.eatWhile(/[^'"\/\\]/);if(s.eat("\\")){s.next();if(r&&s.eol()){return i}}else if(s.match(n)){o.tokenize=v;return i}else{s.eat(/['"\/]/)}}if(r){if(e.mode.singleLineStringErrors){i=t}else{o.tokenize=v}}return i}}function g(e,t){while(!e.eol()){e.eatWhile(/[^#]/);if(e.match("###")){t.tokenize=v;break}e.eatWhile("#")}return"comment"}function y(t,n,r){r=r||"coffee";var i=0,s=false,o=null;for(var u=n.scope;u;u=u.prev){if(u.type==="coffee"){i=u.offset+e.indentUnit;break}}if(r!=="coffee"){s=null;o=t.column()+t.current().length}else if(n.scope.align){n.scope.align=false}n.scope={offset:i,type:r,prev:n.scope,align:s,alignOffset:o}}function b(e,t){if(!t.scope.prev)return;if(t.scope.type==="coffee"){var n=e.indentation();var r=false;for(var i=t.scope;i;i=i.prev){if(n===i.offset){r=true;break}}if(!r){return true}while(t.scope.prev&&t.scope.offset!==n){t.scope=t.scope.prev}return false}else{t.scope=t.scope.prev;return false}}function w(e,n){var r=n.tokenize(e,n);var i=e.current();if(i==="."){r=n.tokenize(e,n);i=e.current();if(/^\.[\w$]+$/.test(i)){return"variable"}else{return t}}if(i==="return"){n.dedent+=1}if((i==="->"||i==="=>")&&!n.lambda&&!e.peek()||r==="indent"){y(e,n)}var s="[({".indexOf(i);if(s!==-1){y(e,n,"])}".slice(s,s+1))}if(a.exec(i)){y(e,n)}if(i=="then"){b(e,n)}if(r==="dedent"){if(b(e,n)){return t}}s="])}".indexOf(i);if(s!==-1){while(n.scope.type=="coffee"&&n.scope.prev)n.scope=n.scope.prev;if(n.scope.type==i)n.scope=n.scope.prev}if(n.dedent>0&&e.eol()&&n.scope.type=="coffee"){if(n.scope.prev)n.scope=n.scope.prev;n.dedent-=1}return r}var t="error";var r=/^(?:->|=>|\+[+=]?|-[\-=]?|\*[\*=]?|\/[\/=]?|[=!]=|<[><]?=?|>>?=?|%=?|&=?|\|=?|\^=?|\~|!|\?)/;var i=/^(?:[()\[\]{},:`=;]|\.\.?\.?)/;var s=/^[_A-Za-z$][_A-Za-z$0-9]*/;var o=/^(@|this\.)[_A-Za-z$][_A-Za-z$0-9]*/;var u=n(["and","or","not","is","isnt","in","instanceof","typeof"]);var a=["for","while","loop","if","unless","else","switch","try","catch","finally","class"];var f=["break","by","continue","debugger","delete","do","in","of","new","return","then","this","throw","when","until"];var l=n(a.concat(f));a=n(a);var c=/^('{3}|\"{3}|['\"])/;var h=/^(\/{3}|\/)/;var p=["Infinity","NaN","undefined","null","true","false","on","off","yes","no"];var d=n(p);var E={startState:function(e){return{tokenize:v,scope:{offset:e||0,type:"coffee",prev:null,align:false},lastToken:null,lambda:false,dedent:0}},token:function(e,t){var n=t.scope.align===null&&t.scope;if(n&&e.sol())n.align=false;var r=w(e,t);if(n&&r&&r!="comment")n.align=true;t.lastToken={style:r,content:e.current()};if(e.eol()&&e.lambda){t.lambda=false}return r},indent:function(e,t){if(e.tokenize!=v)return 0;var n=e.scope;var r=t&&"])}".indexOf(t.charAt(0))>-1;if(r)while(n.type=="coffee"&&n.prev)n=n.prev;var i=r&&n.type===t.charAt(0);if(n.align)return n.alignOffset-(i?1:0);else return(i?n.prev:n).offset},lineComment:"#",fold:"indent"};return E});e.defineMIME("text/x-coffeescript","coffeescript")})