(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../smarty/smarty"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../htmlmixed/htmlmixed","../smarty/smarty"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("smartymixed",function(t){var n,r,i,s,o=e.getMode(t,"htmlmixed"),u=e.getMode(t,"smarty"),n={rightDelimiter:"}",leftDelimiter:"{"};if(t.hasOwnProperty("leftDelimiter")){n.leftDelimiter=t.leftDelimiter}if(t.hasOwnProperty("rightDelimiter")){n.rightDelimiter=t.rightDelimiter}r={smartyComment:new RegExp("^"+n.leftDelimiter+"\\*"),literalOpen:new RegExp(n.leftDelimiter+"literal"+n.rightDelimiter),literalClose:new RegExp(n.leftDelimiter+"/literal"+n.rightDelimiter),hasLeftDelimeter:new RegExp(".*"+n.leftDelimiter),htmlHasLeftDelimeter:new RegExp("[^<>]*"+n.leftDelimiter)};i={chain:function(e,t,n){t.tokenize=n;return n(e,t)},cleanChain:function(e,t,n){t.tokenize=null;t.localState=null;t.localMode=null;return typeof n=="string"?n?n:null:n(e,t)},maybeBackup:function(e,t,n){var r=e.current();var i=r.search(t),s;if(i>-1)e.backUp(r.length-i);else if(s=r.match(/<\/?$/)){e.backUp(r.length);if(!e.match(t,false))e.match(r[0])}return n}};s={html:function(e,t){if(!t.inLiteral&&e.match(r.htmlHasLeftDelimeter,false)&&t.htmlMixedState.htmlState.tagName===null){t.tokenize=s.smarty;t.localMode=u;t.localState=u.startState(o.indent(t.htmlMixedState,""));return i.maybeBackup(e,n.leftDelimiter,u.token(e,t.localState))}else if(!t.inLiteral&&e.match(n.leftDelimiter,false)){t.tokenize=s.smarty;t.localMode=u;t.localState=u.startState(o.indent(t.htmlMixedState,""));return i.maybeBackup(e,n.leftDelimiter,u.token(e,t.localState))}return o.token(e,t.htmlMixedState)},smarty:function(e,t){if(e.match(n.leftDelimiter,false)){if(e.match(r.smartyComment,false)){return i.chain(e,t,s.inBlock("comment","*"+n.rightDelimiter))}}else if(e.match(n.rightDelimiter,false)){e.eat(n.rightDelimiter);t.tokenize=s.html;t.localMode=o;t.localState=t.htmlMixedState;return"tag"}return i.maybeBackup(e,n.rightDelimiter,u.token(e,t.localState))},inBlock:function(e,t){return function(n,r){while(!n.eol()){if(n.match(t)){i.cleanChain(n,r,"");break}n.next()}return e}}};return{startState:function(){var e=o.startState();return{token:s.html,localMode:null,localState:null,htmlMixedState:e,tokenize:null,inLiteral:false}},copyState:function(t){var n=null,r=t.tokenize||t.token;if(t.localState){n=e.copyState(r!=s.html?u:o,t.localState)}return{token:t.token,tokenize:t.tokenize,localMode:t.localMode,localState:n,htmlMixedState:e.copyState(o,t.htmlMixedState),inLiteral:t.inLiteral}},token:function(e,t){if(e.match(n.leftDelimiter,false)){if(!t.inLiteral&&e.match(r.literalOpen,true)){t.inLiteral=true;return"keyword"}else if(t.inLiteral&&e.match(r.literalClose,true)){t.inLiteral=false;return"keyword"}}if(t.inLiteral&&t.localState!=t.htmlMixedState){t.tokenize=s.html;t.localMode=o;t.localState=t.htmlMixedState}var i=(t.tokenize||t.token)(e,t);return i},indent:function(t,n){if(t.localMode==u||t.inLiteral&&!t.localMode||r.hasLeftDelimeter.test(n)){return e.Pass}return o.indent(t.htmlMixedState,n)},innerMode:function(e){return{state:e.localState||e.htmlMixedState,mode:e.localMode||o}}}},"htmlmixed","smarty");e.defineMIME("text/x-smarty","smartymixed")})