(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("rst",function(t,n){var r=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/;var i=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/;var s=/^``[^`\s](?:[^`]*[^`\s])``/;var o=/^(?:[\d]+(?:[\.,]\d+)*)/;var u=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/;var a=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/;var f="[Hh][Tt][Tt][Pp][Ss]?://";var l="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})";var c="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*";var h=new RegExp("^"+f+l+c);var p={token:function(e){if(e.match(r)&&e.match(/\W+|$/,false))return"strong";if(e.match(i)&&e.match(/\W+|$/,false))return"em";if(e.match(s)&&e.match(/\W+|$/,false))return"string-2";if(e.match(o))return"number";if(e.match(u))return"positive";if(e.match(a))return"negative";if(e.match(h))return"link";while(e.next()!=null){if(e.match(r,false))break;if(e.match(i,false))break;if(e.match(s,false))break;if(e.match(o,false))break;if(e.match(u,false))break;if(e.match(a,false))break;if(e.match(h,false))break}return null}};var d=e.getMode(t,n.backdrop||"rst-base");return e.overlayMode(d,p,true)},"python","stex");e.defineMode("rst-base",function(t){function n(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return typeof t[n]!="undefined"?t[n]:e})}function r(e){this.message=e}function i(e,t){if(!e)throw new r(t);return e}function z(t,n){var r=null;if(t.sol()&&t.match(U,false)){Q(n,J,{mode:s,local:e.startState(s)})}else if(t.sol()&&t.match(y)){Q(n,W);r="meta"}else if(t.sol()&&t.match(g)){Q(n,z);r="header"}else if(Y(n)==A||t.match(A,false)){switch(G(n)){case 0:Q(n,z,K(A,1));i(t.match(/^:/));r="meta";break;case 1:Q(n,z,K(A,2));i(t.match(c));r="keyword";if(t.current().match(/^(?:math|latex)/)){n.tmp_stex=true}break;case 2:Q(n,z,K(A,3));i(t.match(/^:`/));r="meta";break;case 3:if(n.tmp_stex){n.tmp_stex=undefined;n.tmp={mode:o,local:e.startState(o)}}if(n.tmp){if(t.peek()=="`"){Q(n,z,K(A,4));n.tmp=undefined;break}r=n.tmp.mode.token(t,n.tmp.local);break}Q(n,z,K(A,4));i(t.match(m));r="string";break;case 4:Q(n,z,K(A,5));i(t.match(/^`/));r="meta";break;case 5:Q(n,z,K(A,6));i(t.match(f));break;default:Q(n,z);i(t.current()=="")}}else if(Y(n)==O||t.match(O,false)){switch(G(n)){case 0:Q(n,z,K(O,1));i(t.match(/^`/));r="meta";break;case 1:Q(n,z,K(O,2));i(t.match(m));r="string";break;case 2:Q(n,z,K(O,3));i(t.match(/^`:/));r="meta";break;case 3:Q(n,z,K(O,4));i(t.match(c));r="keyword";break;case 4:Q(n,z,K(O,5));i(t.match(/^:/));r="meta";break;case 5:Q(n,z,K(O,6));i(t.match(f));break;default:Q(n,z);i(t.current()=="")}}else if(Y(n)==M||t.match(M,false)){switch(G(n)){case 0:Q(n,z,K(M,1));i(t.match(/^:/));r="meta";break;case 1:Q(n,z,K(M,2));i(t.match(c));r="keyword";break;case 2:Q(n,z,K(M,3));i(t.match(/^:/));r="meta";break;case 3:Q(n,z,K(M,4));i(t.match(f));break;default:Q(n,z);i(t.current()=="")}}else if(Y(n)==T||t.match(T,false)){switch(G(n)){case 0:Q(n,z,K(T,1));i(t.match(P));r="variable-2";break;case 1:Q(n,z,K(T,2));if(t.match(/^_?_?/))r="link";break;default:Q(n,z);i(t.current()=="")}}else if(t.match(N)){Q(n,z);r="quote"}else if(t.match(C)){Q(n,z);r="quote"}else if(t.match(k)){Q(n,z);if(!t.peek()||t.peek().match(/^\W$/)){r="link"}}else if(Y(n)==L||t.match(L,false)){switch(G(n)){case 0:if(!t.peek()||t.peek().match(/^\W$/)){Q(n,z,K(L,1))}else{t.match(L)}break;case 1:Q(n,z,K(L,2));i(t.match(/^`/));r="link";break;case 2:Q(n,z,K(L,3));i(t.match(m));break;case 3:Q(n,z,K(L,4));i(t.match(/^`_/));r="link";break;default:Q(n,z);i(t.current()=="")}}else if(t.match(R)){Q(n,V)}else{if(t.next())Q(n,z)}return r}function W(t,n){var r=null;if(Y(n)==E||t.match(E,false)){switch(G(n)){case 0:Q(n,W,K(E,1));i(t.match(P));r="variable-2";break;case 1:Q(n,W,K(E,2));i(t.match(H));break;case 2:Q(n,W,K(E,3));i(t.match(B));r="keyword";break;case 3:Q(n,W,K(E,4));i(t.match(j));r="meta";break;default:Q(n,z);i(t.current()=="")}}else if(Y(n)==w||t.match(w,false)){switch(G(n)){case 0:Q(n,W,K(w,1));i(t.match(_));r="keyword";if(t.current().match(/^(?:math|latex)/))n.tmp_stex=true;else if(t.current().match(/^python/))n.tmp_py=true;break;case 1:Q(n,W,K(w,2));i(t.match(D));r="meta";if(t.match(/^latex\s*$/)||n.tmp_stex){n.tmp_stex=undefined;Q(n,J,{mode:o,local:e.startState(o)})}break;case 2:Q(n,W,K(w,3));if(t.match(/^python\s*$/)||n.tmp_py){n.tmp_py=undefined;Q(n,J,{mode:s,local:e.startState(s)})}break;default:Q(n,z);i(t.current()=="")}}else if(Y(n)==b||t.match(b,false)){switch(G(n)){case 0:Q(n,W,K(b,1));i(t.match(F));i(t.match(I));r="link";break;case 1:Q(n,W,K(b,2));i(t.match(q));r="meta";break;default:Q(n,z);i(t.current()=="")}}else if(t.match(S)){Q(n,z);r="quote"}else if(t.match(x)){Q(n,z);r="quote"}else{t.eatSpace();if(t.eol()){Q(n,z)}else{t.skipToEnd();Q(n,X);r="comment"}}return r}function X(e,t){return $(e,t,"comment")}function V(e,t){return $(e,t,"meta")}function $(e,t,n){if(e.eol()||e.eatSpace()){e.skipToEnd();return n}else{Q(t,z);return null}}function J(e,t){if(t.ctx.mode&&t.ctx.local){if(e.sol()){if(!e.eatSpace())Q(t,z);return null}return t.ctx.mode.token(e,t.ctx.local)}Q(t,z);return null}function K(e,t,n,r){return{phase:e,stage:t,mode:n,local:r}}function Q(e,t,n){e.tok=t;e.ctx=n||{}}function G(e){return e.ctx.stage||0}function Y(e){return e.ctx.phase}r.prototype.toString=function(){return"AssertException: "+this.message};var s=e.getMode(t,"python");var o=e.getMode(t,"stex");var u="\\s+";var a="(?:\\s*|\\W|$)",f=new RegExp(n("^{0}",a));var l="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",c=new RegExp(n("^{0}",l));var h="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)";var p=n("(?:{0}|`{1}`)",l,h);var d="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)";var v="(?:[^\\`]+)",m=new RegExp(n("^{0}",v));var g=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$");var y=new RegExp(n("^\\.\\.{0}",u));var b=new RegExp(n("^_{0}:{1}|^__:{1}",p,a));var w=new RegExp(n("^{0}::{1}",p,a));var E=new RegExp(n("^\\|{0}\\|{1}{2}::{3}",d,u,p,a));var S=new RegExp(n("^\\[(?:\\d+|#{0}?|\\*)]{1}",p,a));var x=new RegExp(n("^\\[{0}\\]{1}",p,a));var T=new RegExp(n("^\\|{0}\\|",d));var N=new RegExp(n("^\\[(?:\\d+|#{0}?|\\*)]_",p));var C=new RegExp(n("^\\[{0}\\]_",p));var k=new RegExp(n("^{0}__?",p));var L=new RegExp(n("^`{0}`_",v));var A=new RegExp(n("^:{0}:`{1}`{2}",l,v,a));var O=new RegExp(n("^`{1}`:{0}:{2}",l,v,a));var M=new RegExp(n("^:{0}:{1}",l,a));var _=new RegExp(n("^{0}",p));var D=new RegExp(n("^::{0}",a));var P=new RegExp(n("^\\|{0}\\|",d));var H=new RegExp(n("^{0}",u));var B=new RegExp(n("^{0}",p));var j=new RegExp(n("^::{0}",a));var F=new RegExp("^_");var I=new RegExp(n("^{0}|_",p));var q=new RegExp(n("^:{0}",a));var R=new RegExp("^::\\s*$");var U=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");return{startState:function(){return{tok:z,ctx:K(undefined,0)}},copyState:function(t){var n=t.ctx,r=t.tmp;if(n.local)n={mode:n.mode,local:e.copyState(n.mode,n.local)};if(r)r={mode:r.mode,local:e.copyState(r.mode,r.local)};return{tok:t.tok,ctx:n,tmp:r}},innerMode:function(e){return e.tmp?{state:e.tmp.local,mode:e.tmp.mode}:e.ctx.mode?{state:e.ctx.local,mode:e.ctx.mode}:null},token:function(e,t){return t.tok(e,t)}}},"python","stex");e.defineMIME("text/x-rst","rst")})