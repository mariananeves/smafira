(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("tiki",function(e){function t(e,t,n){return function(i,s){while(!i.eol()){if(i.match(t)){s.tokenize=r;break}i.next()}if(n)s.tokenize=n;return e}}function n(e){return function(t,n){while(!t.eol()){t.next()}n.tokenize=r;return e}}function r(e,i){function s(t){i.tokenize=t;return t(e,i)}var o=e.sol();var a=e.next();switch(a){case"{":e.eat("/");e.eatSpace();var f="";var l;while(l=e.eat(/[^\s\u00a0=\"\'\/?(}]/))f+=l;i.tokenize=u;return"tag";break;case"_":if(e.eat("_")){return s(t("strong","__",r))}break;case"'":if(e.eat("'")){return s(t("em","''",r))}break;case"(":if(e.eat("(")){return s(t("variable-2","))",r))}break;case"[":return s(t("variable-3","]",r));break;case"|":if(e.eat("|")){return s(t("comment","||"))}break;case"-":if(e.eat("=")){return s(t("header string","=-",r))}else if(e.eat("-")){return s(t("error tw-deleted","--",r))}break;case"=":if(e.match("==")){return s(t("tw-underline","===",r))}break;case":":if(e.eat(":")){return s(t("comment","::"))}break;case"^":return s(t("tw-box","^"));break;case"~":if(e.match("np~")){return s(t("meta","~/np~"))}break}if(o){switch(a){case"!":if(e.match("!!!!!")){return s(n("header string"))}else if(e.match("!!!!")){return s(n("header string"))}else if(e.match("!!!")){return s(n("header string"))}else if(e.match("!!")){return s(n("header string"))}else{return s(n("header string"))}break;case"*":case"#":case"+":return s(n("tw-listitem bracket"));break}}return null}function u(e,t){var n=e.next();var i=e.peek();if(n=="}"){t.tokenize=r;return"tag"}else if(n=="("||n==")"){return"bracket"}else if(n=="="){o="equals";if(i==">"){n=e.next();i=e.peek()}if(!/[\'\"]/.test(i)){t.tokenize=f()}return"operator"}else if(/[\'\"]/.test(n)){t.tokenize=a(n);return t.tokenize(e,t)}else{e.eatWhile(/[^\s\u00a0=\"\'\/?]/);return"keyword"}}function a(e){return function(t,n){while(!t.eol()){if(t.next()==e){n.tokenize=u;break}}return"string"}}function f(){return function(e,t){while(!e.eol()){var n=e.next();var r=e.peek();if(n==" "||n==","||/[ )}]/.test(r)){t.tokenize=u;break}}return"string"}}function h(){for(var e=arguments.length-1;e>=0;e--)l.cc.push(arguments[e])}function p(){h.apply(null,arguments);return true}function d(e,t){var n=l.context&&l.context.noIndent;l.context={prev:l.context,pluginName:e,indent:l.indented,startOfLine:t,noIndent:n}}function v(){if(l.context)l.context=l.context.prev}function m(e){if(e=="openPlugin"){l.pluginName=s;return p(b,g(l.startOfLine))}else if(e=="closePlugin"){var t=false;if(l.context){t=l.context.pluginName!=s;v()}else{t=true}if(t)c="error";return p(y(t))}else if(e=="string"){if(!l.context||l.context.name!="!cdata")d("!cdata");if(l.tokenize==r)v();return p()}else return p()}function g(e){return function(t){if(t=="selfclosePlugin"||t=="endPlugin")return p();if(t=="endPlugin"){d(l.pluginName,e);return p()}return p()}}function y(e){return function(t){if(e)c="error";if(t=="endPlugin")return p();return h()}}function b(e){if(e=="keyword"){c="attribute";return p(b)}if(e=="equals")return p(w,b);return h()}function w(e){if(e=="keyword"){c="string";return p()}if(e=="string")return p(E);return h()}function E(e){if(e=="string")return p(E);else return h()}var i=e.indentUnit;var s,o;var l,c;return{startState:function(){return{tokenize:r,cc:[],indented:0,startOfLine:true,pluginName:null,context:null}},token:function(e,t){if(e.sol()){t.startOfLine=true;t.indented=e.indentation()}if(e.eatSpace())return null;c=o=s=null;var n=t.tokenize(e,t);if((n||o)&&n!="comment"){l=t;while(true){var r=t.cc.pop()||m;if(r(o||n))break}}t.startOfLine=false;return c||n},indent:function(e,t){var n=e.context;if(n&&n.noIndent)return 0;if(n&&/^{\//.test(t))n=n.prev;while(n&&!n.startOfLine)n=n.prev;if(n)return n.indent+i;else return 0},electricChars:"/"}});e.defineMIME("text/tiki","tiki")})