(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],e);else e(CodeMirror)})(function(e){"use strict";(function(){"use strict";e.defineMode("haml",function(t){function i(e){return function(t,n){var r=t.peek();if(r==e&&n.rubyState.tokenize.length==1){t.next();n.tokenize=o;return"closeAttributeTag"}else{return s(t,n)}}}function s(e,t){if(e.match("-#")){e.skipToEnd();return"comment"}return r.token(e,t.rubyState)}function o(e,t){var r=e.peek();if(t.previousToken.style=="comment"){if(t.indented>t.previousToken.indented){e.skipToEnd();return"commentLine"}}if(t.startOfLine){if(r=="!"&&e.match("!!")){e.skipToEnd();return"tag"}else if(e.match(/^%[\w:#\.]+=/)){t.tokenize=s;return"hamlTag"}else if(e.match(/^%[\w:]+/)){return"hamlTag"}else if(r=="/"){e.skipToEnd();return"comment"}}if(t.startOfLine||t.previousToken.style=="hamlTag"){if(r=="#"||r=="."){e.match(/[\w-#\.]*/);return"hamlAttribute"}}if(t.startOfLine&&!e.match("-->",false)&&(r=="="||r=="-")){t.tokenize=s;return null}if(t.previousToken.style=="hamlTag"||t.previousToken.style=="closeAttributeTag"||t.previousToken.style=="hamlAttribute"){if(r=="("){t.tokenize=i(")");return null}else if(r=="{"){t.tokenize=i("}");return null}}return n.token(e,t.htmlState)}var n=e.getMode(t,{name:"htmlmixed"});var r=e.getMode(t,"ruby");return{startState:function(){var e=n.startState();var t=r.startState();return{htmlState:e,rubyState:t,indented:0,previousToken:{style:null,indented:0},tokenize:o}},copyState:function(t){return{htmlState:e.copyState(n,t.htmlState),rubyState:e.copyState(r,t.rubyState),indented:t.indented,previousToken:t.previousToken,tokenize:t.tokenize}},token:function(e,t){if(e.sol()){t.indented=e.indentation();t.startOfLine=true}if(e.eatSpace())return null;var n=t.tokenize(e,t);t.startOfLine=false;if(n&&n!="commentLine"){t.previousToken={style:n,indented:t.indented}}if(e.eol()&&t.tokenize==s){e.backUp(1);var r=e.peek();e.next();if(r&&r!=","){t.tokenize=o}}if(n=="hamlTag"){n="tag"}else if(n=="commentLine"){n="comment"}else if(n=="hamlAttribute"){n="attribute"}else if(n=="closeAttributeTag"){n=null}return n}}},"htmlmixed","ruby");e.defineMIME("text/x-haml","haml")})()})