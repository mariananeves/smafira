(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("velocity",function(){function e(e){var t={},n=e.split(" ");for(var r=0;r<n.length;++r)t[n[r]]=true;return t}function s(e,t,n){t.tokenize=n;return n(e,t)}function o(e,o){var l=o.beforeParams;o.beforeParams=false;var c=e.next();if(c=="'"&&o.inParams){o.lastTokenWasBuiltin=false;return s(e,o,u(c))}else if(c=='"'){o.lastTokenWasBuiltin=false;if(o.inString){o.inString=false;return"string"}else if(o.inParams)return s(e,o,u(c))}else if(/[\[\]{}\(\),;\.]/.test(c)){if(c=="("&&l)o.inParams=true;else if(c==")"){o.inParams=false;o.lastTokenWasBuiltin=true}return null}else if(/\d/.test(c)){o.lastTokenWasBuiltin=false;e.eatWhile(/[\w\.]/);return"number"}else if(c=="#"&&e.eat("*")){o.lastTokenWasBuiltin=false;return s(e,o,a)}else if(c=="#"&&e.match(/ *\[ *\[/)){o.lastTokenWasBuiltin=false;return s(e,o,f)}else if(c=="#"&&e.eat("#")){o.lastTokenWasBuiltin=false;e.skipToEnd();return"comment"}else if(c=="$"){e.eatWhile(/[\w\d\$_\.{}]/);if(r&&r.propertyIsEnumerable(e.current())){return"keyword"}else{o.lastTokenWasBuiltin=true;o.beforeParams=true;return"builtin"}}else if(i.test(c)){o.lastTokenWasBuiltin=false;e.eatWhile(i);return"operator"}else{e.eatWhile(/[\w\$_{}@]/);var h=e.current();if(t&&t.propertyIsEnumerable(h))return"keyword";if(n&&n.propertyIsEnumerable(h)||e.current().match(/^#@?[a-z0-9_]+ *$/i)&&e.peek()=="("&&!(n&&n.propertyIsEnumerable(h.toLowerCase()))){o.beforeParams=true;o.lastTokenWasBuiltin=false;return"keyword"}if(o.inString){o.lastTokenWasBuiltin=false;return"string"}if(e.pos>h.length&&e.string.charAt(e.pos-h.length-1)=="."&&o.lastTokenWasBuiltin)return"builtin";o.lastTokenWasBuiltin=false;return null}}function u(e){return function(t,n){var r=false,i,s=false;while((i=t.next())!=null){if(i==e&&!r){s=true;break}if(e=='"'&&t.peek()=="$"&&!r){n.inString=true;s=true;break}r=!r&&i=="\\"}if(s)n.tokenize=o;return"string"}}function a(e,t){var n=false,r;while(r=e.next()){if(r=="#"&&n){t.tokenize=o;break}n=r=="*"}return"comment"}function f(e,t){var n=0,r;while(r=e.next()){if(r=="#"&&n==2){t.tokenize=o;break}if(r=="]")n++;else if(r!=" ")n=0}return"meta"}var t=e("#end #else #break #stop #[[ #]] "+"#{end} #{else} #{break} #{stop}");var n=e("#if #elseif #foreach #set #include #parse #macro #define #evaluate "+"#{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}");var r=e("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent");var i=/[+\-*&%=<>!?:\/|]/;return{startState:function(){return{tokenize:o,beforeParams:false,inParams:false,inString:false,lastTokenWasBuiltin:false}},token:function(e,t){if(e.eatSpace())return null;return t.tokenize(e,t)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}});e.defineMIME("text/velocity","velocity")})