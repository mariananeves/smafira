(function(){function e(e,n,r){var i={},s=0,o=e.length,u=[];while(e){var a=e.match(/^(\w+)(\*?)(?:='([^\']*)'|<(~?)(\w+)(?:\/(\d+)-(\d+))?)\s*/);var f=a[1],l=a[2],c;if(a[3]){c=l?CodeMirror.Doc(a[3]):CodeMirror(n,t(r,{value:a[3]}))}else{var h=a[5];if(!i.hasOwnProperty(h)){i[h]=u.length;u.push(CodeMirror(n,r))}var p=u[i[h]].linkedDoc({sharedHist:!a[4],from:a[6]?Number(a[6]):null,to:a[7]?Number(a[7]):null});c=l?p:CodeMirror(n,t(r,{value:p}))}i[f]=u.length;u.push(c);e=e.slice(a[0].length)}return u}function t(e,n){if(!e)return;t.prototype=e;var r=new t;if(n)for(var i in n)if(n.hasOwnProperty(i))r[i]=n[i];return r}function n(e){var t=arguments.length,n=null;if(typeof arguments[t-1]=="string")n=arguments[--t];if(r==t)throw new Error("No editors provided to eqAll");for(var r=1;r<t;++r)eq(arguments[r].getValue(),e,n)}function r(t,n,r,i,s){if(!i)i={};return test("doc_"+t,function(){var t=document.getElementById("testground");var s=e(n,t,i);var o=false;try{r.apply(null,s);o=true}finally{if(!o||verbose){t.style.visibility="visible"}else{for(var u=0;u<s.length;++u)if(s[u]instanceof CodeMirror)t.removeChild(s[u].getWrapperElement())}}},s)}function s(e,t){n("x",e,t);e.setValue("hey");n("hey",e,t);t.setValue("wow");n("wow",e,t);e.replaceRange("u\nv\nw",Pos(0,3));t.replaceRange("i",Pos(0,4));t.replaceRange("j",Pos(2,1));n("wowui\nv\nwj",e,t)}var i=/MSIE [1-7]\b/.test(navigator.userAgent);r("basic","A='x' B<A",s);r("basicSeparate","A='x' B<~A",s);r("sharedHist","A='ab\ncd\nef' B<A",function(e,t){e.replaceRange("x",Pos(0));t.replaceRange("y",Pos(1));e.replaceRange("z",Pos(2));n("abx\ncdy\nefz",e,t);e.undo();e.undo();n("abx\ncd\nef",e,t);e.redo();n("abx\ncdy\nef",e,t);t.redo();n("abx\ncdy\nefz",e,t);e.undo();t.undo();e.undo();e.undo();n("ab\ncd\nef",e,t)},null,i);r("undoIntact","A='ab\ncd\nef' B<~A",function(e,t){e.replaceRange("x",Pos(0));t.replaceRange("y",Pos(1));e.replaceRange("z",Pos(2));e.replaceRange("q",Pos(0));n("abxq\ncdy\nefz",e,t);e.undo();e.undo();n("abx\ncdy\nef",e,t);t.undo();n("abx\ncd\nef",e,t);e.redo();n("abx\ncd\nefz",e,t);e.redo();n("abxq\ncd\nefz",e,t);e.undo();e.undo();e.undo();e.undo();n("ab\ncd\nef",e,t);t.redo();n("ab\ncdy\nef",e,t)});r("undoConflict","A='ab\ncd\nef' B<~A",function(e,t){e.replaceRange("x",Pos(0));e.replaceRange("z",Pos(2));t.replaceRange("y",Pos(0));e.undo();e.undo();n("abxy\ncd\nef",e,t);e.replaceRange("u",Pos(2));e.replaceRange("v",Pos(0));t.replaceRange("w",Pos(0));e.undo();e.undo();n("abxyvw\ncd\nefu",e,t)});r("doubleRebase","A='ab\ncd\nef\ng' B<~A C<B",function(e,t,r){r.replaceRange("u",Pos(3));e.replaceRange("",Pos(0,0),Pos(1,0));r.undo();n("cd\nef\ng",e,t,r)});r("undoUpdate","A='ab\ncd\nef' B<~A",function(e,t){e.replaceRange("x",Pos(2));t.replaceRange("u\nv\nw\n",Pos(0,0));e.undo();n("u\nv\nw\nab\ncd\nef",e,t);e.redo();n("u\nv\nw\nab\ncd\nefx",e,t);e.undo();n("u\nv\nw\nab\ncd\nef",e,t);t.undo();e.redo();n("ab\ncd\nefx",e,t);e.undo();n("ab\ncd\nef",e,t)});r("undoKeepRanges","A='abcdefg' B<A",function(e,t){var n=e.markText(Pos(0,1),Pos(0,3),{className:"foo"});t.replaceRange("x",Pos(0,0));eqPos(n.find().from,Pos(0,2));t.replaceRange("yzzy",Pos(0,1),Pos(0));eq(n.find(),null);t.undo();eqPos(n.find().from,Pos(0,2));t.undo();eqPos(n.find().from,Pos(0,1))});r("longChain","A='uv' B<A C<B D<C",function(e,t,r,i){e.replaceSelection("X");n("Xuv",e,t,r,i);i.replaceRange("Y",Pos(0));n("XuvY",e,t,r,i)});r("broadCast","B<A C<A D<A E<A",function(e,t,r,i,s){t.setValue("uu");n("uu",e,t,r,i,s);e.replaceRange("v",Pos(0,1));n("uvu",e,t,r,i,s)});r("islands","A='x\ny\nz' B<A C<~A D<C",function(e,t,r,i){e.replaceRange("u",Pos(0));i.replaceRange("v",Pos(2));t.undo();n("x\ny\nzv",e,t,r,i);r.undo();n("x\ny\nz",e,t,r,i);e.redo();n("xu\ny\nz",e,t,r,i);i.redo();n("xu\ny\nzv",e,t,r,i)});r("unlink","B<A C<A D<B",function(e,t,r,i){e.setValue("hi");t.unlinkDoc(e);i.setValue("aye");n("hi",e,r);n("aye",t,i);e.setValue("oo");n("oo",e,r);n("aye",t,i)});r("bareDoc","A*='foo' B*<A C<B",function(e,t,r){is(e instanceof CodeMirror.Doc);is(t instanceof CodeMirror.Doc);is(r instanceof CodeMirror);n("foo",e,t,r);e.replaceRange("hey",Pos(0,0),Pos(0));r.replaceRange("!",Pos(0));n("hey!",e,t,r);t.unlinkDoc(e);t.setValue("x");n("x",t,r);n("hey!",e)});r("swapDoc","A='a' B*='b' C<A",function(e,t,r){var i=e.swapDoc(t);i.setValue("x");n("x",r,i);n("b",e,t)});r("docKeepsScroll","A='x' B*='y'",function(e,t){addDoc(e,200,200);e.scrollIntoView(Pos(199,200));var n=e.swapDoc(t);e.swapDoc(n);var r=e.getScrollInfo();is(r.left>0,"not at left");is(r.top>0,"not at top")});r("copyDoc","A='u'",function(e){var t=e.getDoc().copy(true);e.setValue("foo");t.setValue("bar");var n=e.swapDoc(t);eq(e.getValue(),"bar");e.undo();eq(e.getValue(),"u");e.swapDoc(n);eq(e.getValue(),"foo");eq(n.historySize().undo,1);eq(n.copy(false).historySize().undo,0)});r("docKeepsMode","A='1+1'",function(e){var t=CodeMirror.Doc("hi","text/x-markdown");e.setOption("mode","text/javascript");var n=e.swapDoc(t);eq(e.getOption("mode"),"text/x-markdown");eq(e.getMode().name,"markdown");e.swapDoc(n);eq(e.getOption("mode"),"text/javascript");eq(e.getMode().name,"javascript")});r("subview","A='1\n2\n3\n4\n5' B<~A/1-3",function(e,t){eq(t.getValue(),"2\n3");eq(t.firstLine(),1);t.setCursor(Pos(4));eqPos(t.getCursor(),Pos(2,1));e.replaceRange("-1\n0\n",Pos(0,0));eq(t.firstLine(),3);eqPos(t.getCursor(),Pos(4,1));e.undo();eqPos(t.getCursor(),Pos(2,1));t.replaceRange("oyoy\n",Pos(2,0));eq(e.getValue(),"1\n2\noyoy\n3\n4\n5");t.undo();eq(e.getValue(),"1\n2\n3\n4\n5")});r("subviewEditOnBoundary","A='11\n22\n33\n44\n55' B<~A/1-4",function(e,t){e.replaceRange("x\nyy\nz",Pos(0,1),Pos(2,1));eq(t.firstLine(),2);eq(t.lineCount(),2);eq(t.getValue(),"z3\n44");e.replaceRange("q\nrr\ns",Pos(3,1),Pos(4,1));eq(t.firstLine(),2);eq(t.getValue(),"z3\n4q");eq(e.getValue(),"1x\nyy\nz3\n4q\nrr\ns5");e.execCommand("selectAll");e.replaceSelection("!");n("!",e,t)});r("sharedMarker","A='ab\ncd\nef\ngh' B<A C<~A/1-2",function(e,t,n){var r=t.markText(Pos(0,1),Pos(3,1),{className:"cm-searching",shared:true});var i=e.findMarksAt(Pos(0,2));eq(i.length,1);eq(i[0],r);eq(n.findMarksAt(Pos(1,1)).length,1);eqPos(r.find().from,Pos(0,1));eqPos(r.find().to,Pos(3,1));t.replaceRange("x\ny\n",Pos(0,0));eqPos(r.find().from,Pos(2,1));eqPos(r.find().to,Pos(5,1));var s=0;CodeMirror.on(r,"clear",function(){++s});t.operation(function(){r.clear()});eq(e.findMarksAt(Pos(3,1)).length,0);eq(t.findMarksAt(Pos(3,1)).length,0);eq(n.findMarksAt(Pos(3,1)).length,0);eq(r.find(),null);eq(s,1)});r("sharedMarkerCopy","A='abcde'",function(e){var t=e.markText(Pos(0,1),Pos(0,3),{shared:true});var n=e.linkedDoc();var r=n.findMarksAt(Pos(0,2));eq(r.length,1);eq(r[0],t);t.clear();eq(n.findMarksAt(Pos(0,2)),0)});r("sharedMarkerDetach","A='abcde' B<A C<B",function(e,t,n){var r=e.markText(Pos(0,1),Pos(0,3),{shared:true});e.unlinkDoc(t);var i=t.findMarksAt(Pos(0,2));eq(i.length,1);is(i[0]!=r);var s=n.findMarksAt(Pos(0,2));eq(s.length,1);is(s[0]!=r);s[0].clear();is(r.find())});r("sharedBookmark","A='ab\ncd\nef\ngh' B<A C<~A/1-2",function(e,t,n){var r=t.setBookmark(Pos(1,1),{shared:true});var i=e.findMarksAt(Pos(1,1));eq(i.length,1);eq(i[0],r);eq(n.findMarksAt(Pos(1,1)).length,1);eqPos(r.find(),Pos(1,1));t.replaceRange("x\ny\n",Pos(0,0));eqPos(r.find(),Pos(3,1));var s=0;CodeMirror.on(r,"clear",function(){++s});t.operation(function(){r.clear()});eq(e.findMarks(Pos(0,0),Pos(5)).length,0);eq(t.findMarks(Pos(0,0),Pos(5)).length,0);eq(n.findMarks(Pos(0,0),Pos(5)).length,0);eq(r.find(),null);eq(s,1)});r("undoInSubview","A='line 0\nline 1\nline 2\nline 3\nline 4' B<A/1-4",function(e,t){t.replaceRange("x",Pos(2,0));e.undo();eq(e.getValue(),"line 0\nline 1\nline 2\nline 3\nline 4");eq(t.getValue(),"line 1\nline 2\nline 3")})})()