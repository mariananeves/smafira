function waitFor(e,t){if(e()){t()}else{setTimeout(function(){waitFor(e,t)},250)}}var page=require("webpage").create();page.open("http://localhost:3000/test/index.html",function(e){if(e!="success"){console.log("page couldn't be loaded successfully");phantom.exit(1)}waitFor(function(){return page.evaluate(function(){var e=document.getElementById("status");if(!e){return false}return/^(\d+ failures?|all passed)/i.test(e.innerText)})},function(){var e=page.evaluate(function(){return window.failed});var t=page.evaluate(function(){return document.getElementById("output").innerText+"\n"+document.getElementById("status").innerText});console.log(t);phantom.exit(e>0?1:0)})})