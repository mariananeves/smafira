(function(){function e(e){var t=e.listSelections();var n=(arguments.length-1)/4;if(t.length!=n)throw new Failure("expected "+n+" selections, found "+t.length);for(var r=0,i=1;r<n;r++,i+=4){var s=Pos(arguments[i],arguments[i+1]);var o=Pos(arguments[i+2],arguments[i+3]);eqPos(t[r].anchor,s,"anchor of selection "+r);eqPos(t[r].head,o,"head of selection "+r)}}function t(e){var t=e.listSelections();var n=(arguments.length-1)/2;if(t.length!=n)throw new Failure("expected "+n+" selections, found "+t.length);for(var r=0,i=1;r<n;r++,i+=2){eqPos(t[r].anchor,t[r].head,"something selected for "+r);var s=Pos(arguments[i],arguments[i+1]);eqPos(t[r].head,s,"selection "+r)}}function n(e){var t=[];for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r.head)t.push(r);else t.push({head:r,anchor:r})}e.setSelections(t,t.length-1)}namespace="multi_";testCM("getSelection",function(e){n(e,{anchor:Pos(0,0),head:Pos(1,2)},{anchor:Pos(2,2),head:Pos(2,0)});eq(e.getSelection(),"1234\n56\n90");eq(e.getSelection(false).join("|"),"1234|56|90");eq(e.getSelections().join("|"),"1234\n56|90")},{value:"1234\n5678\n90"});testCM("setSelection",function(r){n(r,Pos(3,0),Pos(0,0),{anchor:Pos(2,5),head:Pos(1,0)});e(r,0,0,0,0,2,5,1,0,3,0,3,0);r.setSelection(Pos(1,2),Pos(1,1));e(r,1,2,1,1);n(r,{anchor:Pos(1,1),head:Pos(2,4)},{anchor:Pos(0,0),head:Pos(1,3)},Pos(3,0),Pos(2,2));e(r,0,0,2,4,3,0,3,0);r.setSelections([{anchor:Pos(0,1),head:Pos(0,2)},{anchor:Pos(1,1),head:Pos(1,2)},{anchor:Pos(2,1),head:Pos(2,2)}],1);eqPos(r.getCursor("head"),Pos(1,2));eqPos(r.getCursor("anchor"),Pos(1,1));eqPos(r.getCursor("from"),Pos(1,1));eqPos(r.getCursor("to"),Pos(1,2));r.setCursor(Pos(1,1));t(r,1,1)},{value:"abcde\nabcde\nabcde\n"});testCM("somethingSelected",function(e){n(e,Pos(0,1),{anchor:Pos(0,3),head:Pos(0,5)});eq(e.somethingSelected(),true);n(e,Pos(0,1),Pos(0,3),Pos(0,5));eq(e.somethingSelected(),false)},{value:"123456789"});testCM("extendSelection",function(t){n(t,Pos(0,1),Pos(1,1),Pos(2,1));t.setExtending(true);t.extendSelections([Pos(0,2),Pos(1,0),Pos(2,3)]);e(t,0,1,0,2,1,1,1,0,2,1,2,3);t.extendSelection(Pos(2,4),Pos(2,0));e(t,2,4,2,0)},{value:"1234\n1234\n1234"});testCM("addSelection",function(t){n(t,Pos(0,1),Pos(1,1));t.addSelection(Pos(0,0),Pos(0,4));e(t,0,0,0,4,1,1,1,1);t.addSelection(Pos(2,2));e(t,0,0,0,4,1,1,1,1,2,2,2,2)},{value:"1234\n1234\n1234"});testCM("replaceSelection",function(t){var n=[{anchor:Pos(0,0),head:Pos(0,1)},{anchor:Pos(0,2),head:Pos(0,3)},{anchor:Pos(0,4),head:Pos(0,5)},{anchor:Pos(2,1),head:Pos(2,4)},{anchor:Pos(2,5),head:Pos(2,6)}];var r="123456\n123456\n123456";t.setValue(r);t.setSelections(n);t.replaceSelection("ab","around");eq(t.getValue(),"ab2ab4ab6\n123456\n1ab5ab");e(t,0,0,0,2,0,3,0,5,0,6,0,8,2,1,2,3,2,4,2,6);t.setValue(r);t.setSelections(n);t.replaceSelection("","around");eq(t.getValue(),"246\n123456\n15");e(t,0,0,0,0,0,1,0,1,0,2,0,2,2,1,2,1,2,2,2,2);t.setValue(r);t.setSelections(n);t.replaceSelection("X\nY\nZ","around");e(t,0,0,2,1,2,2,4,1,4,2,6,1,8,1,10,1,10,2,12,1);t.replaceSelection("a","around");e(t,0,0,0,1,0,2,0,3,0,4,0,5,2,1,2,2,2,3,2,4);t.replaceSelection("xy","start");e(t,0,0,0,0,0,3,0,3,0,6,0,6,2,1,2,1,2,4,2,4);t.replaceSelection("z\nf");e(t,1,1,1,1,2,1,2,1,3,1,3,1,6,1,6,1,7,1,7,1);eq(t.getValue(),"z\nfxy2z\nfxy4z\nfxy6\n123456\n1z\nfxy5z\nfxy")});testCM("indentSelection",function(e){n(e,Pos(0,1),Pos(1,1));e.indentSelection(4);eq(e.getValue(),"    foo\n    bar\nbaz");n(e,Pos(0,2),Pos(0,3),Pos(0,4));e.indentSelection(-2);eq(e.getValue(),"  foo\n    bar\nbaz");n(e,{anchor:Pos(0,0),head:Pos(1,2)},{anchor:Pos(1,3),head:Pos(2,0)});e.indentSelection(-2);eq(e.getValue(),"foo\n  bar\nbaz")},{value:"foo\nbar\nbaz"});testCM("killLine",function(e){n(e,Pos(0,1),Pos(0,2),Pos(1,1));e.execCommand("killLine");eq(e.getValue(),"f\nb\nbaz");e.execCommand("killLine");eq(e.getValue(),"fbbaz");e.setValue("foo\nbar\nbaz");n(e,Pos(0,1),{anchor:Pos(0,2),head:Pos(2,1)});e.execCommand("killLine");eq(e.getValue(),"faz")},{value:"foo\nbar\nbaz"});testCM("deleteLine",function(e){n(e,Pos(0,0),{head:Pos(0,1),anchor:Pos(2,0)},Pos(4,0));e.execCommand("deleteLine");eq(e.getValue(),"4\n6\n7");n(e,Pos(2,1));e.execCommand("deleteLine");eq(e.getValue(),"4\n6\n")},{value:"1\n2\n3\n4\n5\n6\n7"});testCM("deleteH",function(e){n(e,Pos(0,4),{anchor:Pos(1,4),head:Pos(1,5)});e.execCommand("delWordAfter");eq(e.getValue(),"foo bar baz\nabc ef ghi\n");e.execCommand("delWordAfter");eq(e.getValue(),"foo  baz\nabc  ghi\n");e.execCommand("delCharBefore");e.execCommand("delCharBefore");eq(e.getValue(),"fo baz\nab ghi\n");n(e,Pos(0,3),Pos(0,4),Pos(0,5));e.execCommand("delWordAfter");eq(e.getValue(),"fo \nab ghi\n")},{value:"foo bar baz\nabc def ghi\n"});testCM("goLineStart",function(r){n(r,Pos(0,2),Pos(0,3),Pos(1,1));r.execCommand("goLineStart");t(r,0,0,1,0);n(r,Pos(1,1),Pos(0,1));r.setExtending(true);r.execCommand("goLineStart");e(r,0,1,0,0,1,1,1,0)},{value:"foo\nbar\nbaz"});testCM("moveV",function(r){n(r,Pos(0,2),Pos(1,2));r.execCommand("goLineDown");t(r,1,2,2,2);r.execCommand("goLineUp");t(r,0,2,1,2);r.execCommand("goLineUp");t(r,0,0,0,2);r.execCommand("goLineUp");t(r,0,0);n(r,Pos(0,2),Pos(1,2));r.setExtending(true);r.execCommand("goLineDown");e(r,0,2,2,2)},{value:"12345\n12345\n12345"});testCM("moveH",function(e){n(e,Pos(0,1),Pos(0,3),Pos(0,5),Pos(2,3));e.execCommand("goCharRight");t(e,0,2,0,4,1,0,2,4);e.execCommand("goCharLeft");t(e,0,1,0,3,0,5,2,3);for(var r=0;r<15;r++)e.execCommand("goCharRight");t(e,2,4,2,5)},{value:"12345\n12345\n12345"});testCM("newlineAndIndent",function(e){n(e,Pos(0,5),Pos(1,5));e.execCommand("newlineAndIndent");t(e,1,2,3,2);eq(e.getValue(),"x = [\n  1];\ny = [\n  2];");e.undo();eq(e.getValue(),"x = [1];\ny = [2];");t(e,0,5,1,5);n(e,Pos(0,5),Pos(0,6));e.execCommand("newlineAndIndent");t(e,1,2,2,0);eq(e.getValue(),"x = [\n  1\n];\ny = [2];")},{value:"x = [1];\ny = [2];",mode:"javascript"});testCM("goDocStartEnd",function(r){n(r,Pos(0,1),Pos(1,1));r.execCommand("goDocStart");t(r,0,0);n(r,Pos(0,1),Pos(1,1));r.execCommand("goDocEnd");t(r,1,3);n(r,Pos(0,1),Pos(1,1));r.setExtending(true);r.execCommand("goDocEnd");e(r,1,1,1,3)},{value:"abc\ndef"});testCM("selectionHistory",function(e){for(var t=0;t<3;++t)e.addSelection(Pos(0,t*2),Pos(0,t*2+1));e.execCommand("undoSelection");eq(e.getSelection(),"1\n2");e.execCommand("undoSelection");eq(e.getSelection(),"1");e.execCommand("undoSelection");eq(e.getSelection(),"");eqPos(e.getCursor(),Pos(0,0));e.execCommand("redoSelection");eq(e.getSelection(),"1");e.execCommand("redoSelection");eq(e.getSelection(),"1\n2");e.execCommand("redoSelection");eq(e.getSelection(),"1\n2\n3")},{value:"1 2 3"})})()