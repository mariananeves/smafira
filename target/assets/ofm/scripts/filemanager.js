(function(e){function p(e){var t=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(!t){throw new Error("XMLHttpRequest not supported")}t.open("HEAD",e,false);t.send(null);if(t.status==200){return true}return false}function b(t,n){if(t["File Type"]=="dir"&&(n=="download"||n=="replace"))return false;if(typeof t["Capabilities"]=="undefined")return true;else return e.inArray(n,t["Capabilities"])>-1}function X(t){var n=t.attr("class").replace(/ /g,"_");if(n=="")return"itemOptions";if(!e("#"+n).length){var r=e("#itemOptions").clone().attr("id",n);if(!t.hasClass("cap_select"))e(".select",r).remove();if(!t.hasClass("cap_download"))e(".download",r).remove();if(!t.hasClass("cap_rename"))e(".rename",r).remove();if(!t.hasClass("cap_move"))e(".move",r).remove();e(".replace",r).remove();if(!t.hasClass("cap_delete"))e(".delete",r).remove();e("#itemOptions").after(r)}return n}e.urlParam=function(e){var t=(new RegExp("[\\?&]"+e+"=([^&#]*)")).exec(window.location.href);if(t)return t[1];else return 0};var t=function(t){var n=null;t=typeof t==="undefined"?"user":t;if(t=="user"){var i=configUrl}else{var i=r+"/scripts/filemanager.config.js.default"}e.ajax({async:false,url:i,dataType:"json",cache:false,success:function(e){n=e}});return n};var n=t();var n=e.extend({},n);var r=n.custom.ofmBase;var s=n.custom.fileConnector;var o=n.custom.space;var u=n.custom.type;HEAD_included_files=new Array;loadCSS=function(t){if(e.inArray(t,HEAD_included_files)==-1){var n=e("<link rel='stylesheet' type='text/css' href='"+t+"'>");e("head").append(n);HEAD_included_files.push(t)}};loadJS=function(t){if(e.inArray(t,HEAD_included_files)==-1){var n=e("<script type='text/javascript' src='"+t+"'>");e("head").append(n);HEAD_included_files.push(t)}};var a=n.options.capabilities||new Array("select","download","rename","move","delete","replace");if(e.urlParam("langCode")!=0&&p(r+"/scripts/languages/"+e.urlParam("langCode")+".js"))n.options.culture=e.urlParam("langCode");var f=[];e.ajax({url:r+"/scripts/languages/"+n.options.culture+".js",async:false,dataType:"json",success:function(e){f=e}});e.prompt.setDefaults({overlayspeed:"fast",show:"fadeIn",opacity:.4,persistent:false});var l=function(){var t=20;if(n.options.searchBox===true)t+=33;if(e.urlParam("CKEditorCleanUpFuncNum"))t+=60;var r=e(window).height()-e("#uploader").height()-t;e("#splitter, #filetree, #fileinfo, .vsplitbar").height(r);var i=e("#splitter").width()-6-e("#filetree").width();e("#fileinfo").width(i)};var c=function(e,t){t=typeof t==="undefined"?true:false;if(n.options.showFullPath==false){if("function"===typeof displayPathDecorator){return displayPathDecorator(e.replace(fileRoot,"/"))}else{e=e.replace(fileRoot,"/");if(e.length>50&&t===true){var r=e.split("/");e="/"+r[1]+"/"+r[2]+"/(...)/"+r[r.length-2]+"/"}return e}}else{return e}};var h=function(t){if(t=="grid"){e("#grid").addClass("ON");e("#list").removeClass("ON")}else{e("#list").addClass("ON");e("#grid").removeClass("ON")}};var d=function(e,t,n){var r=String(n);for(i=0;i<e.length;i++){var s=RegExp(e[i],"g");var o=t[i];r=r.replace(s,o)}return r};var v=function(e){var t="";var r=new Array("Š","š","Đ","đ","Ž","ž","Č","č","Ć","ć","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ñ","Ò","Ó","Ô","Õ","Ö","Ő","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","â","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","ő","ø","ù","ú","û","ü","ý","ý","þ","ÿ","Ŕ","ŕ"," ","'","/");var i=new Array("S","s","Dj","dj","Z","z","C","c","C","c","A","A","A","A","A","A","A","C","E","E","E","E","I","I","I","I","N","O","O","O","O","O","O","O","U","U","U","U","Y","B","Ss","a","a","a","a","a","a","a","c","e","e","e","e","i","i","i","i","o","n","o","o","o","o","o","o","o","u","u","u","u","y","y","b","y","R","r","_","_","");t=d(r,i,e);if(n.options.chars_only_latin){t=t.replace(/[^_a-zA-Z0-9]/g,"")}t=t.replace(/[_]+/g,"_");return t};var m=function(e){filename="";if(e.lastIndexOf(".")!=-1){filename=v(e.substr(0,e.lastIndexOf(".")));filename+="."+e.split(".").pop()}else{filename=v(e)}return filename};var g=function(e){var t=parseFloat(e);var n=parseFloat(1024);var r=0;var i=[f.bytes,f.kb,f.mb,f.gb];while(true){if(t<n){t=Math.round(t*100)/100;return t+i[r]}else{t/=n;r+=1}}};var y=function(t){e("#fileinfo").html("<h1>"+t+"</h1>");e("#newfile").attr("disabled","disabled");e("#upload").attr("disabled","disabled");e("#newfolder").attr("disabled","disabled")};var w=function(t){if(n.security.uploadPolicy=="DISALLOW_ALL"){if(e.inArray(S(t),n.security.uploadRestrictions)!=-1)return true}if(n.security.uploadPolicy=="ALLOW_ALL"){if(e.inArray(S(t),n.security.uploadRestrictions)==-1)return true}return false};var E=function(e,t){var n=e.replace(/^.*[\/\\]/g,"");if(typeof t=="string"&&n.substr(n.length-t.length)==t){n=n.substr(0,n.length-t.length)}return n};var S=function(e){if(e.split(".").length==1){return""}return e.split(".").pop().toLowerCase()};var x=function(e){if(e.lastIndexOf(".")!=-1){return e.substring(0,e.lastIndexOf("."))}else{return e}};var T=function(t){if(e.inArray(S(t),n.edit.editExt)!=-1){return true}else{return false}};var N=function(t){if(e.inArray(S(t),n.images.imagesExt)!=-1){return true}else{return false}};var C=function(t){if(e.inArray(S(t),n.videos.videosExt)!=-1){return true}else{return false}};var k=function(t){if(e.inArray(S(t),n.audios.audiosExt)!=-1){return true}else{return false}};var L=function(t){var r="<video width="+n.videos.videosPlayerWidth+" height="+n.videos.videosPlayerHeight+' src="'+t["Path"]+'" controls="controls">';r+='<img src="'+t["Preview"]+'" />';r+="</video>";e("#fileinfo img").remove();e("#fileinfo #preview h1").before(r)};var A=function(t){var n='<audio src="'+t["Path"]+'" controls="controls">';n+='<img src="'+t["Preview"]+'" />';n+="</audio>";e("#fileinfo img").remove();e("#fileinfo #preview h1").before(n)};var O=function(t){e("#fileinfo").find("td:first-child").each(function(){var n=e(this).attr("data-path");var r=e("#filetree").find('a[data-path="'+n+'"]').parent();if(typeof r.css("background-image")!=="undefined"){e(this).css("background-image",r.css("background-image"));window.clearInterval(t)}})};var M=function(t){e("#currentpath").val(t);e("#uploader h1").text(f.current_folder+c(t)).attr("title",c(t,false)).attr("data-path",t);e("#newfolder").unbind().click(function(){var t=f.default_foldername;var n=f.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+t+'" />';var r=function(n,r){if(n!=1)return false;var i=r.children("#fname").val();if(i!=""){t=v(i);var a=new Date;e.getJSON(s+"?mode=addfolder&path="+e("#currentpath").val()+"&name="+t+"&space="+o+"&type="+u+"&time="+a.getMilliseconds(),function(t){if(t["Code"]==0){z(t["Parent"],t["Name"]);J(t["Parent"]);e("#filetree").find('a[data-path="'+t["Parent"]+'/"]').click().click()}else{e.prompt(t["Error"])}})}else{e.prompt(f.no_foldername)}};var i={};i[f.create_folder]=true;i[f.cancel]=false;e.prompt(n,{callback:r,buttons:i})})};var _=function(t){e("#fileinfo button").each(function(t){if(e(this).find("span").length==0)e(this).wrapInner("<span></span>")});if(!b(t,"select")){e("#fileinfo").find("button#select").hide()}else{e("#fileinfo").find("button#select").click(function(){P(t)}).show();if(window.opener||window.tinyMCEPopup){e("#preview img").attr("title",f.select);e("#preview img").click(function(){P(t)}).css("cursor","pointer")}}if(!b(t,"rename")){e("#fileinfo").find("button#rename").hide()}else{e("#fileinfo").find("button#rename").click(function(){var n=H(t);if(n.length)e("#fileinfo > h1").text(n)}).show()}if(!b(t,"move")){e("#fileinfo").find("button#move").hide()}else{e("#fileinfo").find("button#move").click(function(){var n=j(t);if(n.length)e("#fileinfo > h1").text(n)}).show()}if(!b(t,"replace")){e("#fileinfo").find("button#replace").hide()}else{e("#fileinfo").find("button#replace").click(function(){B(t)}).show()}if(!b(t,"delete")){e("#fileinfo").find("button#delete").hide()}else{e("#fileinfo").find("button#delete").click(function(){if(F(t))e("#fileinfo").html("<h1>"+f.select_from_left+"</h1>")}).show()}if(!b(t,"download")){e("#fileinfo").find("button#download").hide()}else{e("#fileinfo").find("button#download").click(function(){window.location=s+"?mode=download&path="+encodeURIComponent(t["Path"])+"&space="+o+"&type="+u}).show()}};var D=function(){e("#filetree").fileTree({root:fileRoot,datafunc:K,multiFolder:false,folderCallback:function(e){J(e)},expandedFolder:fullexpandedFolder,after:function(t){e("#filetree").find("li a").each(function(){e(this).contextMenu({menu:X(e(this))},function(t,n,r){var i=e(n).attr("data-path");V(t,i)})});if(n.options.searchBox==true){e("#q").liveUpdate("#filetree ul").blur();e("#search span.q-inactive").html(f.search);e("#search a.q-reset").attr("title",f.search_reset)}}},function(e){$(e)})};var P=function(t){if(n.options.relPath!==false){var r=relPath+t["Path"]}else{var r=relPath+t["Path"]}if(window.opener||e.urlParam("CKEditorCleanUpFuncNum")||e.urlParam("CKEditor")){if(e.urlParam("CKEditor")){if(window.opener){window.opener.CKEDITOR.tools.callFunction(e.urlParam("CKEditorFuncNum"),r)}else{parent.CKEDITOR.tools.callFunction(e.urlParam("CKEditorFuncNum"),r);parent.CKEDITOR.tools.callFunction(e.urlParam("CKEditorCleanUpFuncNum"))}}else{try{window.opener.ckeditorFileBrowserItemSelected(r)}catch(i){}}if(window.opener){window.close()}}else{e.prompt(f.fck_select_integration)}};var H=function(t){var r="";var i=n.security.allowChangeExtensions?t["Filename"]:x(t["Filename"]);var a=f.new_filename+' : <input id="rname" name="rname" type="text" value="'+i+'" />';var l=function(i,a){if(i!=1)return false;rname=a.children("#rname").val();if(rname!=""){var l=rname;if(!n.security.allowChangeExtensions){l=m(rname);var c=S(t["Filename"]);if(c.length>0){l=l+"."+c}}if(!w(l)){var h="<p>"+f.INVALID_FILE_TYPE+"</p>";if(n.security.uploadPolicy=="DISALLOW_ALL"){h+="<p>"+f.ALLOWED_FILE_TYPE+n.security.uploadRestrictions.join(", ")+".</p>"}if(n.security.uploadPolicy=="ALLOW_ALL"){h+="<p>"+f.DISALLOWED_FILE_TYPE+n.security.uploadRestrictions.join(", ")+".</p>"}e("#filepath").val("");e.prompt(h);return false}var p=t["Path"];var d=s+"?mode=rename&old="+t["Path"]+"&new="+l+"&space="+o+"&type="+u;e.ajax({type:"GET",url:d,dataType:"json",async:false,success:function(i){if(i["Code"]==0){var s=i["New Path"];var o=i["New Name"];R(p,s,o);var u=e("#preview h1").attr("title");if(typeof u!="undefined"&&u==p){e("#preview h1").text(o)}if(e("#fileinfo").data("view")=="grid"){e('#fileinfo img[data-path="'+p+'"]').parent().next("p").text(o);e('#fileinfo img[data-path="'+p+'"]').attr("data-path",s)}else{e('#fileinfo td[data-path="'+p+'"]').text(o);e('#fileinfo td[data-path="'+p+'"]').attr("data-path",s)}e("#preview h1").html(o);t["Path"]=s;t["Filename"]=o;e("#fileinfo").find("button#rename, button#delete, button#download").unbind();_(t);if(n.options.showConfirmation)e.prompt(f.successful_rename)}else{e.prompt(i["Error"])}r=i["New Name"]}})}};var c={};c[f.rename]=true;c[f.cancel]=false;e.prompt(a,{callback:l,buttons:c});return r};var B=function(t){e("#fileR").bind("change",function(){e(this).closest("form#toolbar").submit()});e("#toolbar").attr("action",s);e("#toolbar").attr("method","post");e("#toolbar").ajaxForm({target:"#uploadresponse",beforeSubmit:function(r,i,s){var o=e("#fileR",i).val();if(o==""){return false}if(S(o)!=t["File Type"]){e.prompt(f.ERROR_REPLACING_FILE+" ."+S(t["Filename"]));return false}e("#replace").attr("disabled",true);e("#upload span").addClass("loading").text(f.loading_data);if(typeof FileReader!=="undefined"&&typeof n.upload.fileSizeLimit!="auto"){var u=e("#fileR",i).get(0).files[0].size;if(u>n.upload.fileSizeLimit*1024*1024){e.prompt("<p>"+f.file_too_big+"</p><p>"+f.file_size_limit+n.upload.fileSizeLimit+" "+f.mb+".</p>");e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload);return false}}},error:function(t,n,r){e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload);e.prompt(f.ERROR_UPLOADING_FILE)},success:function(t){var r=jQuery.parseJSON(e("#uploadresponse").find("textarea").text());if(r["Code"]==0){var i=r["Path"]+"/"+r["Name"];$(i);e("#preview").find("img").hide().fadeIn("slow");e("ul.jqueryFileTree").find('li a[data-path="'+i+'"]').parent().hide().fadeIn("slow");if(n.options.showConfirmation)e.prompt(f.successful_replace)}else{e.prompt(r["Error"])}e("#replace").removeAttr("disabled");e("#upload span").removeClass("loading").text(f.upload)}});e("#newfilepath").val(t["Path"]);e("#fileR").click()};var j=function(t){var r="";var i=f.move+' : <input id="rname" name="rname" type="text" value="" />';var a=function(i,a){if(i!=1)return false;rname=a.children("#rname").val();if(rname!=""){var l=rname;var c=t["Path"];var h=s+"?mode=move&old="+encodeURIComponent(t["Path"])+"&space="+o+"&type="+u+"&new="+encodeURIComponent(l)+"&root="+encodeURIComponent(fileRoot);e.ajax({type:"GET",url:h,dataType:"json",async:false,success:function(t){if(t["Code"]==0){var i=t["New Path"];var s=t["New Name"];fullexpandedFolder=i;D();J(i);if(n.options.showConfirmation)e.prompt(f.successful_moved)}else{e.prompt(t["Error"])}r=i+s}})}};var l={};l[f.move]=true;l[f.cancel]=false;e.prompt(i,{callback:a,buttons:l});return r};var F=function(t){var r=false;var i=f.confirmation_delete;var a=function(i,a){if(i!=1)return false;var l=new Date;var h=s+"?mode=delete&path="+encodeURIComponent(t["Path"])+"&space="+o+"&type="+u+"&time="+l.getMilliseconds();parent=t["Path"].split("/").reverse().slice(1).reverse().join("/")+"/";e.ajax({type:"GET",url:h,dataType:"json",async:false,success:function(t){if(t["Code"]==0){U(t["Path"]);var i=t["Path"].substring(0,t["Path"].length-1);i=i.substr(0,i.lastIndexOf("/")+1);e("#uploader h1").text(f.current_folder+c(i)).attr("title",c(i,false)).attr("data-path",i);r=true;if(n.options.showConfirmation)e.prompt(f.successful_delete);e("#filetree").find('a[data-path="'+parent+'/"]').click().click()}else{r=false;e.prompt(t["Error"])}}})};var l={};l[f.yes]=true;l[f.no]=false;e.prompt(i,{callback:a,buttons:l});return r};var I=function(t){isEdited=false;e("#fileinfo").find("h1").append(' <a id="edit-file" href="#" title="'+f.edit+'"><span>'+f.edit+"</span></a>");e("#edit-file").click(function(){e(this).hide();var r=new Date;var i=s+"?mode=editfile&path="+encodeURIComponent(t["Path"])+"&space="+o+"&type="+u+"&time="+r.getMilliseconds();e.ajax({type:"GET",url:i,dataType:"json",async:false,success:function(r){if(r["Code"]==0){var i='<form id="edit-form">';i+='<textarea id="edit-content" name="content">'+r["Content"]+"</textarea>";i+='<input type="hidden" name="mode" value="savefile" />';i+='<input type="hidden" name="path" value="'+t["Path"]+'" />';i+='<button id="edit-cancel" class="edition" type="button">'+f.quit_editor+"</button>";i+='<button id="edit-save" class="edition" type="button">'+f.save+"</button>";i+="</form>";e("#preview").find("img").hide();e("#preview").prepend(i).hide().fadeIn();e("#edit-cancel").click(function(){e("#preview").find("form#edit-form").hide();e("#preview").find("img").fadeIn();e("#edit-file").show()});e("#edit-save").click(function(){var t=codeMirrorEditor.getValue();e("textarea#edit-content").val(t);var n=e("#edit-form").serializeArray();e.ajax({type:"POST",url:s,dataType:"json",data:n,async:false,success:function(t){if(t["Code"]==0){isEdited=true;e.prompt(f.successful_edit)}else{isEdited=false;e.prompt(t["Error"])}}})});codeMirrorEditor=instantiateCodeMirror(S(t["Path"]),n)}else{isEdited=false;e.prompt(r["Error"]);e(this).show()}}})});return isEdited};var q=function(t,r){var i=S(r);var s=e("#filetree").find('a[data-path="'+t+'"]');var o=s.parent();var u='<li class="file ext_'+i+'"><a data-path="'+t+r+'" href="#" class="">'+r+"</a></li>";if(!o.find("ul").size()){o=e("#filetree").find("ul.jqueryFileTree");o.prepend(u);D()}else{o.find("ul").prepend(u);s.click().click()}J(t);if(n.options.showConfirmation)e.prompt(f.successful_added_file)};var R=function(t,n,r){var i=e("#filetree").find('a[data-path="'+t+'"]');var s=i.parent().parent().prev("a");i.attr("data-path",n).text(r);if(s.length==0){D()}else{s.click().click()}};var U=function(t){e("#filetree").find('a[data-path="'+t+'"]').parent().fadeOut("slow",function(){e(this).remove()});if(e("#uploader h1").attr("data-path")==t){var n=t.split("/");var r=n.slice(0,length-2).join("/")+"/";J(r)}if(e("#fileinfo").data("view")=="grid"){e('#contents img[data-path="'+t+'"]').parent().parent().fadeOut("slow",function(){e(this).remove()})}else{e("table#contents").find('td[data-path="'+t+'"]').parent().fadeOut("slow",function(){e(this).remove()})}if(e("#preview").length){J(t.substr(0,t.lastIndexOf("/")+1))}};var z=function(t,r){var i='<li class="directory collapsed"><a data-path="'+t+r+'/" href="#">'+r+'</a><ul class="jqueryFileTree" style="display: block;"></ul></li>';var s=e("#filetree").find('a[data-path="'+t+'"]');if(t!=fileRoot){s.next("ul").prepend(i).prev("a").click().click()}else{e("#filetree > ul").prepend(i);e("#filetree").find('li a[data-path="'+t+r+'/"]').attr("class","cap_rename cap_delete").click(function(){J(t+r+"/")}).each(function(){e(this).contextMenu({menu:X(e(this))},function(t,n,r){var i=e(n).attr("data-path");V(t,i)})})}if(n.options.showConfirmation)e.prompt(f.successful_added_folder)};var W=function(t){if(t.lastIndexOf("/")==t.length-1){J(t);e("#filetree").find('a[data-path="'+t+'"]').click()}else{$(t)}};var V=function(t,n){var r=new Date;e.getJSON(s+"?mode=getinfo&path="+n+"&space="+o+"&type="+u+"&time="+r.getMilliseconds(),function(n){if(e("#fileinfo").data("view")=="grid"){var i=e("#fileinfo").find('img[data-path="'+n["Path"]+'"]').parent()}else{var i=e("#fileinfo").find('td[data-path="'+n["Path"]+'"]').parent()}switch(t){case"select":P(n);break;case"download":window.location=s+"?mode=download&path="+n["Path"]+"&space="+o+"&type="+u+"&time="+r.getMilliseconds();break;case"rename":var a=H(n);break;case"replace":B(n);break;case"move":var a=j(n);break;case"delete":F(n);break}})};var $=function(t){var r=t.substr(0,t.lastIndexOf("/")+1);M(r);var i='<div id="preview"><img /><h1></h1><dl></dl></div>';i+='<form id="toolbar">';i+='<button id="parentfolder">'+f.parentfolder+"</button>";if(e.inArray("select",a)!=-1&&(e.urlParam("CKEditor")||window.opener||window.tinyMCEPopup||e.urlParam("field_name")))i+='<button id="select" name="select" type="button" value="Select">'+f.select+"</button>";if(e.inArray("download",a)!=-1)i+='<button id="download" name="download" type="button" value="Download">'+f.download+"</button>";if(e.inArray("rename",a)!=-1&&n.options.browseOnly!=true)i+='<button id="rename" name="rename" type="button" value="Rename">'+f.rename+"</button>";if(e.inArray("move",a)!=-1&&n.options.browseOnly!=true)i+='<button id="move" name="move" type="button" value="Move">'+f.move+"</button>";if(e.inArray("delete",a)!=-1&&n.options.browseOnly!=true)i+='<button id="delete" name="delete" type="button" value="Delete">'+f.del+"</button>";if(e.inArray("replace",a)!=-1&&n.options.browseOnly!=true){i+='<button id="replace" name="replace" type="button" value="Replace">'+f.replace+"</button>";i+='<div class="hidden-file-input"><input id="fileR" name="fileR" type="file" /></div>';i+='<input id="mode" name="mode" type="hidden" value="replace" /> ';i+='<input id="newfilepath" name="newfilepath" type="hidden" />'}i+="</form>";e("#fileinfo").html(i);e("#parentfolder").click(function(){J(r)});var l=new Date;e.getJSON(s+"?mode=getinfo&path="+encodeURIComponent(t)+"&space="+o+"&type="+u+"&time="+l.getMilliseconds(),function(r){if(r["Code"]==0){e("#fileinfo").find("h1").text(r["Filename"]).attr("title",t);e("#fileinfo").find("img").attr("src",r["Preview"]);if(C(r["Filename"])&&n.videos.showVideoPlayer==true){L(r)}if(k(r["Filename"])&&n.audios.showAudioPlayer==true){A(r)}if(T(r["Filename"])&&n.edit.enabled==true){I(r)}var i="";if(r["Properties"]["Width"]&&r["Properties"]["Width"]!="")i+="<dt>"+f.dimensions+"</dt><dd>"+r["Properties"]["Width"]+"x"+r["Properties"]["Height"]+"</dd>";if(r["Properties"]["Date Created"]&&r["Properties"]["Date Created"]!="")i+="<dt>"+f.created+"</dt><dd>"+r["Properties"]["Date Created"]+"</dd>";if(r["Properties"]["Date Modified"]&&r["Properties"]["Date Modified"]!="")i+="<dt>"+f.modified+"</dt><dd>"+r["Properties"]["Date Modified"]+"</dd>";if(r["Properties"]["Size"]||parseInt(r["Properties"]["Size"])==0)i+="<dt>"+f.size+"</dt><dd>"+g(r["Properties"]["Size"])+"</dd>";e("#fileinfo").find("dl").html(i);_(r)}else{e.prompt(r["Error"])}})};var J=function(t){M(t);e("#fileinfo").html('<img id="activity" src="'+r+'/images/wait30trans.gif" width="30" height="30" />');var i=new Date;var l=s+"?path="+encodeURIComponent(t)+"&mode=getfolder&showThumbs="+n.options.showThumbs+"&space="+o+"&type="+u+"&time="+i.getMilliseconds();e.getJSON(l,function(t){var r="";if(t.Code=="-1"){y(t.Error);return}if(t){if(e("#fileinfo").data("view")=="grid"){r+='<ul id="contents" class="grid">';for(key in t){var i=t[key]["Properties"];var s="";for(cap in a){if(b(t[key],a[cap])){s+=" cap_"+a[cap]}}var o=64;var u=i["Width"];if(u>1&&u<o)o=u;n.options.showTitleAttr?title=' title="'+t[key]["Path"]+'"':title="";r+='<li class="'+s+'"'+title+'"><div class="clip"><img src="'+t[key]["Preview"]+'" width="'+o+'" alt="'+t[key]["Path"]+'" data-path="'+t[key]["Path"]+'" /></div><p>'+t[key]["Filename"]+"</p>";if(i["Width"]&&i["Width"]!="")r+='<span class="meta dimensions">'+i["Width"]+"x"+i["Height"]+"</span>";if(i["Size"]&&i["Size"]!="")r+='<span class="meta size">'+i["Size"]+"</span>";if(i["Date Created"]&&i["Date Created"]!="")r+='<span class="meta created">'+i["Date Created"]+"</span>";if(i["Date Modified"]&&i["Date Modified"]!="")r+='<span class="meta modified">'+i["Date Modified"]+"</span>";r+="</li>"}r+="</ul>"}else{r+='<table id="contents" class="list">';r+='<thead><tr><th class="headerSortDown"><span>'+f.name+"</span></th><th><span>"+f.dimensions+"</span></th><th><span>"+f.size+"</span></th><th><span>"+f.modified+"</span></th></tr></thead>";r+="<tbody>";for(key in t){var l=t[key]["Path"];var i=t[key]["Properties"];var s="";n.options.showTitleAttr?title=' title="'+t[key]["Path"]+'"':title="";for(cap in a){if(b(t[key],a[cap])){s+=" cap_"+a[cap]}}r+='<tr class="'+s+'">';r+='<td data-path="'+t[key]["Path"]+'"'+title+'">'+t[key]["Filename"]+"</td>";if(i["Width"]&&i["Width"]!=""){r+="<td>"+i["Width"]+"x"+i["Height"]+"</td>"}else{r+="<td></td>"}if(i["Size"]&&i["Size"]!=""){r+='<td><abbr title="'+i["Size"]+'">'+g(i["Size"])+"</abbr></td>"}else{r+="<td></td>"}if(i["Date Modified"]&&i["Date Modified"]!=""){r+="<td>"+i["Date Modified"]+"</td>"}else{r+="<td></td>"}r+="</tr>"}r+="</tbody>";r+="</table>"}}else{r+="<h1>"+f.could_not_retrieve_folder+"</h1>"}e("#fileinfo").html(r);if(e("#fileinfo").data("view")=="grid"){e("#fileinfo").find("#contents li").click(function(){var t=e(this).find("img").attr("data-path");W(t)}).each(function(){e(this).contextMenu({menu:X(e(this))},function(t,n,r){var i=e(n).find("img").attr("data-path");V(t,i)})})}else{e("#fileinfo tbody tr").click(function(){var t=e("td:first-child",this).attr("data-path");W(t)}).each(function(){e(this).contextMenu({menu:X(e(this))},function(t,n,r){var i=e("td:first-child",n).attr("data-path");V(t,i)})});e("#fileinfo").find("table").tablesorter({textExtraction:function(t){if(e(t).find("abbr").size()){return e(t).find("abbr").attr("title")}else{return t.innerHTML}}});var c=setInterval(function(){O(c)},300)}})};var K=function(t,r){var i=new Date;var l=s+"?path="+encodeURIComponent(t)+"&mode=getfolder&showThumbs="+n.options.showThumbs+"&space="+o+"&type="+u+"&time="+i.getMilliseconds();e.getJSON(l,function(e){var t="";if(e.Code=="-1"){y(e.Error);return}if(e){t+='<ul class="jqueryFileTree" style="display: none;">';for(key in e){var i="";for(cap in a){if(b(e[key],a[cap])){i+=" cap_"+a[cap]}}if(e[key]["File Type"]=="dir"){t+='<li class="directory collapsed"><a href="#" class="'+i+'" data-path="'+e[key]["Path"]+'">'+e[key]["Filename"]+"</a></li>"}else{if(n.options.listFiles){t+='<li class="file ext_'+e[key]["File Type"].toLowerCase()+'"><a href="#" class="'+i+'" data-path="'+e[key]["Path"]+'">'+e[key]["Filename"]+"</a></li>"}}}t+="</ul>"}else{t+="<h1>"+f.could_not_retrieve_folder+"</h1>"}r(t)})};e(function(){if(n.extras.extra_js){for(var t=0;t<n.extras.extra_js.length;t++){e.ajax({url:n.extras.extra_js[t],dataType:"script",async:n.extras.extra_js_async})}}if(n.edit.enabled){loadCSS(r+"/scripts/CodeMirror/lib/codemirror.css");loadCSS(r+"/scripts/CodeMirror/theme/"+n.edit.theme+".css");loadJS(r+"/scripts/CodeMirror/lib/codemirror.js");loadJS(r+"/scripts/CodeMirror/addon/selection/active-line.js");loadJS(r+"/scripts/CodeMirror/dynamic-mode.js")}if(!n.options.fileRoot){fileRoot="/"+document.location.pathname.substring(1,document.location.pathname.lastIndexOf("/")+1)+"userfiles/"}else{if(!n.options.serverRoot){fileRoot=n.options.fileRoot}else{fileRoot="/"+n.options.fileRoot}fileRoot=fileRoot.replace(/\/\//g,"/")}if(n.options.relPath===false){relPath=window.location.protocol+"//"+window.location.host}else{relPath=n.options.relPath}if(e.urlParam("exclusiveFolder")!=0){fileRoot+=e.urlParam("exclusiveFolder");if(fileRoot.charAt(fileRoot.length-1)!="/")fileRoot+="/";fileRoot=fileRoot.replace(/\/\//g,"/")}if(e.urlParam("expandedFolder")!=0){expandedFolder=e.urlParam("expandedFolder");fullexpandedFolder=fileRoot+expandedFolder}else{expandedFolder="";fullexpandedFolder=null}if(n.options.autoload==true){e("#upload").append(f.upload);e("#newfolder").append(f.new_folder);e("#grid").attr("title",f.grid_view);e("#list").attr("title",f.list_view);e("#fileinfo h1").append(f.select_from_left);e('#itemOptions a[href$="#select"]').append(f.select);e('#itemOptions a[href$="#download"]').append(f.download);e('#itemOptions a[href$="#rename"]').append(f.rename);e('#itemOptions a[href$="#move"]').append(f.move);e('#itemOptions a[href$="#replace"]').append(f.replace);e('#itemOptions a[href$="#delete"]').append(f.del)}if(e.urlParam("CKEditorCleanUpFuncNum")){e("body").append('<button id="close-btn" type="button">'+f.close+"</button>");e("#close-btn").click(function(){parent.CKEDITOR.tools.callFunction(e.urlParam("CKEditorCleanUpFuncNum"))})}e("#browse").append("+");e("#browse").attr("title",f.browse);e("#newfile").change(function(){e("#filepath").val(e(this).val().replace(/.+[\\\/]/,""))});if(n.options.searchBox===true){e.getScript(r+"/scripts/filemanager.liveSearch.min.js")}else{e("#search").remove()}e("button").wrapInner("<span></span>");e("#fileinfo").data("view",n.options.defaultViewMode);h(n.options.defaultViewMode);e("#home").click(function(){var t=e("#fileinfo").data("view");e("#fileinfo").data("view",t);e("#filetree>ul>li.expanded>a").trigger("click");J(fileRoot)});e("#grid").click(function(){h("grid");e("#fileinfo").data("view","grid");J(e("#currentpath").val())});e("#list").click(function(){h("list");e("#fileinfo").data("view","list");J(e("#currentpath").val())});M(fileRoot);e("#uploader").attr("action",s+"?space="+o+"&type="+u);e("#uploader").ajaxForm({target:"#uploadresponse",beforeSubmit:function(t,r,i){if(e("#newfile",r).val()==""){return false}if(!w(e("#newfile",r).val())){var s="<p>"+f.INVALID_FILE_TYPE+"</p>";if(n.security.uploadPolicy=="DISALLOW_ALL"){s+="<p>"+f.ALLOWED_FILE_TYPE+n.security.uploadRestrictions.join(", ")+".</p>"}if(n.security.uploadPolicy=="ALLOW_ALL"){s+="<p>"+f.DISALLOWED_FILE_TYPE+n.security.uploadRestrictions.join(", ")+".</p>"}e("#filepath").val("");e.prompt(s);return false}e("#upload").attr("disabled",true);e("#upload span").addClass("loading").text(f.loading_data);if(e.urlParam("type").toString().toLowerCase()=="images"){var o=e("#newfile",r).val().toLowerCase().split(".");var u=false;for(key in n.images.imagesExt){if(n.images.imagesExt[key]==o[o.length-1]){u=true}}if(u===false){e.prompt(f.UPLOAD_IMAGES_ONLY);e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload);return false}}if(typeof FileReader!=="undefined"&&typeof n.upload.fileSizeLimit!="auto"){var a=e("#newfile",r).get(0).files[0].size;if(a>n.upload.fileSizeLimit*1024*1024){e.prompt("<p>"+f.file_too_big+"</p><p>"+f.file_size_limit+n.upload.fileSizeLimit+" "+f.mb+".</p>");e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload);return false}}},error:function(t,n,r){e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload);e.prompt(f.ERROR_UPLOADING_FILE)},success:function(t){var n=jQuery.parseJSON(e("#uploadresponse").find("textarea").text());if(n["Code"]==0){q(n["Path"],n["Name"]);e("#filepath, #newfile").val("");if(e.browser.msie)e("#newfile").replaceWith(e("#newfile").clone(true));e("#filetree").find('a[data-path="'+n["Path"]+'/"]').click().click()}else{e.prompt(n["Error"])}e("#upload").removeAttr("disabled");e("#upload span").removeClass("loading").text(f.upload);e("#filepath").val("")}});D();if(!(window.opener||window.tinyMCEPopup||e.urlParam("field_name")))e('#itemOptions a[href$="#select"]').remove();if(n.options.browseOnly==true){e("#file-input-container").remove();e("#upload").remove();e("#newfolder").remove();e("#toolbar").remove("#rename");e(".contextMenu .rename").remove();e(".contextMenu .move").remove();e(".contextMenu .replace").remove();e(".contextMenu .delete").remove()}l();e(window).resize(l);e("#splitter").splitter({sizeLeft:200});W(fileRoot+expandedFolder)});var Q=document.documentElement;Q.setAttribute("data-useragent",navigator.userAgent)})(jQuery)